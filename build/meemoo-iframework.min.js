/*! Meemoo Iframework http://meemoo.org/ - v0.3.5 - 2024-12-23 (1:26:16 AM GMT+0200)
* Copyright (c) 2024 Forrest Oliphant; Licensed MIT, AGPL. */

!function(){var e=this,t=e._,s={},r=Array.prototype,i=Object.prototype,n=Function.prototype,o=r.push,a=r.slice,l=r.concat,d=i.toString,h=i.hasOwnProperty,u=r.forEach,c=r.map,p=r.reduce,f=r.reduceRight,g=r.filter,m=r.every,v=r.some,w=r.indexOf,b=r.lastIndexOf,y=Array.isArray,i=Object.keys,k=n.bind,x=function(e){return e instanceof x?e:this instanceof x?void(this._wrapped=e):new x(e)};"undefined"!=typeof exports?(exports="undefined"!=typeof module&&module.exports?module.exports=x:exports)._=x:e._=x,x.VERSION="1.4.4";var I=x.each=x.forEach=function(e,t,i){if(null!=e)if(u&&e.forEach===u)e.forEach(t,i);else if(e.length===+e.length){for(var n=0,r=e.length;n<r;n++)if(t.call(i,e[n],n,e)===s)return}else for(var o in e)if(x.has(e,o)&&t.call(i,e[o],o,e)===s)return};x.map=x.collect=function(e,n,r){var o=[];return null==e?o:c&&e.map===c?e.map(n,r):(I(e,function(e,t,i){o[o.length]=n.call(r,e,t,i)}),o)};var _="Reduce of empty array with no initial value";x.reduce=x.foldl=x.inject=function(e,n,r,o){var s=2<arguments.length;if(null==e&&(e=[]),p&&e.reduce===p)return o&&(n=x.bind(n,o)),s?e.reduce(n,r):e.reduce(n);if(I(e,function(e,t,i){s?r=n.call(o,r,e,t,i):(r=e,s=!0)}),!s)throw new TypeError(_);return r},x.reduceRight=x.foldr=function(n,r,o,s){var a=2<arguments.length;if(null==n&&(n=[]),f&&n.reduceRight===f)return s&&(r=x.bind(r,s)),a?n.reduceRight(r,o):n.reduceRight(r);var l,h=n.length;if(h!==+h&&(l=x.keys(n),h=l.length),I(n,function(e,t,i){t=l?l[--h]:--h,a?o=r.call(s,o,n[t],t,i):(o=n[t],a=!0)}),!a)throw new TypeError(_);return o},x.find=x.detect=function(e,n,r){var o;return $(e,function(e,t,i){return n.call(r,e,t,i)?(o=e,!0):void 0}),o},x.filter=x.select=function(e,n,r){var o=[];return null==e?o:g&&e.filter===g?e.filter(n,r):(I(e,function(e,t,i){n.call(r,e,t,i)&&(o[o.length]=e)}),o)},x.reject=function(e,n,r){return x.filter(e,function(e,t,i){return!n.call(r,e,t,i)},r)},x.every=x.all=function(e,n,r){n=n||x.identity;var o=!0;return null==e?o:m&&e.every===m?e.every(n,r):(I(e,function(e,t,i){return(o=o&&n.call(r,e,t,i))?void 0:s}),!!o)};var $=x.some=x.any=function(e,n,r){n=n||x.identity;var o=!1;return null==e?o:v&&e.some===v?e.some(n,r):(I(e,function(e,t,i){return(o=o||n.call(r,e,t,i))?s:void 0}),!!o)};x.contains=x.include=function(e,t){return null!=e&&(w&&e.indexOf===w?-1!=e.indexOf(t):$(e,function(e){return e===t}))},x.invoke=function(e,t){var i=a.call(arguments,2),n=x.isFunction(t);return x.map(e,function(e){return(n?t:e[t]).apply(e,i)})},x.pluck=function(e,t){return x.map(e,function(e){return e[t]})},x.where=function(e,i,t){return x.isEmpty(i)?t?null:[]:x[t?"find":"filter"](e,function(e){for(var t in i)if(i[t]!==e[t])return!1;return!0})},x.findWhere=function(e,t){return x.where(e,t,!0)},x.max=function(e,n,r){if(!n&&x.isArray(e)&&e[0]===+e[0]&&e.length<65535)return Math.max.apply(Math,e);if(!n&&x.isEmpty(e))return-1/0;var o={computed:-1/0,value:-1/0};return I(e,function(e,t,i){i=n?n.call(r,e,t,i):e;i>=o.computed&&(o={value:e,computed:i})}),o.value},x.min=function(e,n,r){if(!n&&x.isArray(e)&&e[0]===+e[0]&&e.length<65535)return Math.min.apply(Math,e);if(!n&&x.isEmpty(e))return 1/0;var o={computed:1/0,value:1/0};return I(e,function(e,t,i){i=n?n.call(r,e,t,i):e;o.computed>i&&(o={value:e,computed:i})}),o.value},x.shuffle=function(e){var t,i=0,n=[];return I(e,function(e){t=x.random(i++),n[i-1]=n[t],n[t]=e}),n};function E(t){return x.isFunction(t)?t:function(e){return e[t]}}x.sortBy=function(e,t,n){var r=E(t);return x.pluck(x.map(e,function(e,t,i){return{value:e,index:t,criteria:r.call(n,e,t,i)}}).sort(function(e,t){var i=e.criteria,n=t.criteria;if(i!==n){if(n<i||void 0===i)return 1;if(i<n||void 0===n)return-1}return e.index<t.index?-1:1}),"value")};function S(i,e,n,r){var o={},s=E(e||x.identity);return I(i,function(e,t){t=s.call(n,e,t,i);r(o,t,e)}),o}x.groupBy=function(e,t,i){return S(e,t,i,function(e,t,i){(x.has(e,t)?e[t]:e[t]=[]).push(i)})},x.countBy=function(e,t,i){return S(e,t,i,function(e,t){x.has(e,t)||(e[t]=0),e[t]++})},x.sortedIndex=function(e,t,i,n){for(var r=(i=null==i?x.identity:E(i)).call(n,t),o=0,s=e.length;o<s;){var a=o+s>>>1;r>i.call(n,e[a])?o=1+a:s=a}return o},x.toArray=function(e){return e?x.isArray(e)?a.call(e):e.length===+e.length?x.map(e,x.identity):x.values(e):[]},x.size=function(e){return null==e?0:(e.length===+e.length?e:x.keys(e)).length},x.first=x.head=x.take=function(e,t,i){return null==e?void 0:null==t||i?e[0]:a.call(e,0,t)},x.initial=function(e,t,i){return a.call(e,0,e.length-(null==t||i?1:t))},x.last=function(e,t,i){return null==e?void 0:null==t||i?e[e.length-1]:a.call(e,Math.max(e.length-t,0))},x.rest=x.tail=x.drop=function(e,t,i){return a.call(e,null==t||i?1:t)},x.compact=function(e){return x.filter(e,x.identity)};function C(e,t,i){return I(e,function(e){x.isArray(e)?t?o.apply(i,e):C(e,t,i):i.push(e)}),i}x.flatten=function(e,t){return C(e,t,[])},x.without=function(e){return x.difference(e,a.call(arguments,1))},x.uniq=x.unique=function(i,n,e,t){x.isFunction(n)&&(t=e,e=n,n=!1);var t=e?x.map(i,e,t):i,r=[],o=[];return I(t,function(e,t){(n?t&&o[o.length-1]===e:x.contains(o,e))||(o.push(e),r.push(i[t]))}),r},x.union=function(){return x.uniq(l.apply(r,arguments))},x.intersection=function(e){var i=a.call(arguments,1);return x.filter(x.uniq(e),function(t){return x.every(i,function(e){return 0<=x.indexOf(e,t)})})},x.difference=function(e){var t=l.apply(r,a.call(arguments,1));return x.filter(e,function(e){return!x.contains(t,e)})},x.zip=function(){for(var e=a.call(arguments),t=x.max(x.pluck(e,"length")),i=Array(t),n=0;n<t;n++)i[n]=x.pluck(e,""+n);return i},x.object=function(e,t){if(null==e)return{};for(var i={},n=0,r=e.length;n<r;n++)t?i[e[n]]=t[n]:i[e[n][0]]=e[n][1];return i},x.indexOf=function(e,t,i){if(null==e)return-1;var n=0,r=e.length;if(i){if("number"!=typeof i)return e[n=x.sortedIndex(e,t)]===t?n:-1;n=i<0?Math.max(0,r+i):i}if(w&&e.indexOf===w)return e.indexOf(t,i);for(;n<r;n++)if(e[n]===t)return n;return-1},x.lastIndexOf=function(e,t,i){if(null==e)return-1;var n=null!=i;if(b&&e.lastIndexOf===b)return n?e.lastIndexOf(t,i):e.lastIndexOf(t);for(var r=n?i:e.length;r--;)if(e[r]===t)return r;return-1},x.range=function(e,t,i){arguments.length<=1&&(t=e||0,e=0),i=arguments[2]||1;for(var n=Math.max(Math.ceil((t-e)/i),0),r=0,o=Array(n);r<n;)o[r++]=e,e+=i;return o},x.bind=function(e,t){if(e.bind===k&&k)return k.apply(e,a.call(arguments,1));var i=a.call(arguments,2);return function(){return e.apply(t,i.concat(a.call(arguments)))}},x.partial=function(e){var t=a.call(arguments,1);return function(){return e.apply(this,t.concat(a.call(arguments)))}},x.bindAll=function(t){var e=a.call(arguments,1);return 0===e.length&&(e=x.functions(t)),I(e,function(e){t[e]=x.bind(t[e],t)}),t},x.memoize=function(t,i){var n={};return i=i||x.identity,function(){var e=i.apply(this,arguments);return x.has(n,e)?n[e]:n[e]=t.apply(this,arguments)}},x.delay=function(e,t){var i=a.call(arguments,2);return setTimeout(function(){return e.apply(null,i)},t)},x.defer=function(e){return x.delay.apply(x,[e,1].concat(a.call(arguments,1)))},x.throttle=function(i,n){function r(){h=new Date,a=null,l=i.apply(o,s)}var o,s,a,l,h=0;return function(){var e=new Date,t=n-(e-h);return o=this,s=arguments,t<=0?(clearTimeout(a),a=null,h=e,l=i.apply(o,s)):a=a||setTimeout(r,t),l}},x.debounce=function(n,r,o){var s,a;return function(){var e=this,t=arguments,i=o&&!s;return clearTimeout(s),s=setTimeout(function(){s=null,o||(a=n.apply(e,t))},r),a=i?n.apply(e,t):a}},x.once=function(e){var t,i=!1;return function(){return i||(i=!0,t=e.apply(this,arguments),e=null),t}},x.wrap=function(t,i){return function(){var e=[t];return o.apply(e,arguments),i.apply(this,e)}},x.compose=function(){var i=arguments;return function(){for(var e=arguments,t=i.length-1;0<=t;t--)e=[i[t].apply(this,e)];return e[0]}},x.after=function(e,t){return e<=0?t():function(){return--e<1?t.apply(this,arguments):void 0}},x.keys=i||function(e){if(e!==Object(e))throw new TypeError("Invalid object");var t,i=[];for(t in e)x.has(e,t)&&(i[i.length]=t);return i},x.values=function(e){var t,i=[];for(t in e)x.has(e,t)&&i.push(e[t]);return i},x.pairs=function(e){var t,i=[];for(t in e)x.has(e,t)&&i.push([t,e[t]]);return i},x.invert=function(e){var t,i={};for(t in e)x.has(e,t)&&(i[e[t]]=t);return i},x.functions=x.methods=function(e){var t,i=[];for(t in e)x.isFunction(e[t])&&i.push(t);return i.sort()},x.extend=function(i){return I(a.call(arguments,1),function(e){if(e)for(var t in e)i[t]=e[t]}),i},x.pick=function(t){var i={},e=l.apply(r,a.call(arguments,1));return I(e,function(e){e in t&&(i[e]=t[e])}),i},x.omit=function(e){var t,i={},n=l.apply(r,a.call(arguments,1));for(t in e)x.contains(n,t)||(i[t]=e[t]);return i},x.defaults=function(i){return I(a.call(arguments,1),function(e){if(e)for(var t in e)null==i[t]&&(i[t]=e[t])}),i},x.clone=function(e){return x.isObject(e)?x.isArray(e)?e.slice():x.extend({},e):e},x.tap=function(e,t){return t(e),e};function N(e,t,i,n){if(e===t)return 0!==e||1/e==1/t;if(null==e||null==t)return e===t;if(e instanceof x&&(e=e._wrapped),t instanceof x&&(t=t._wrapped),(h=d.call(e))!=d.call(t))return!1;switch(h){case"[object String]":return e==t+"";case"[object Number]":return e!=+e?t!=+t:0==e?1/e==1/t:e==+t;case"[object Date]":case"[object Boolean]":return+e==+t;case"[object RegExp]":return e.source==t.source&&e.global==t.global&&e.multiline==t.multiline&&e.ignoreCase==t.ignoreCase}if("object"!=typeof e||"object"!=typeof t)return!1;for(var r=i.length;r--;)if(i[r]==e)return n[r]==t;i.push(e),n.push(t);var o=0,s=!0;if("[object Array]"==h){if(s=(o=e.length)==t.length)for(;o--&&(s=N(e[o],t[o],i,n)););}else{var a,l=e.constructor,h=t.constructor;if(l!==h&&!(x.isFunction(l)&&l instanceof l&&x.isFunction(h)&&h instanceof h))return!1;for(a in e)if(x.has(e,a)&&(o++,!(s=x.has(t,a)&&N(e[a],t[a],i,n))))break;if(s){for(a in t)if(x.has(t,a)&&!o--)break;s=!o}}return i.pop(),n.pop(),s}x.isEqual=function(e,t){return N(e,t,[],[])},x.isEmpty=function(e){if(null==e)return!0;if(x.isArray(e)||x.isString(e))return 0===e.length;for(var t in e)if(x.has(e,t))return!1;return!0},x.isElement=function(e){return!(!e||1!==e.nodeType)},x.isArray=y||function(e){return"[object Array]"==d.call(e)},x.isObject=function(e){return e===Object(e)},I(["Arguments","Function","String","Number","Date","RegExp"],function(t){x["is"+t]=function(e){return d.call(e)=="[object "+t+"]"}}),x.isArguments(arguments)||(x.isArguments=function(e){return!(!e||!x.has(e,"callee"))}),"function"!=typeof/./&&(x.isFunction=function(e){return"function"==typeof e}),x.isFinite=function(e){return isFinite(e)&&!isNaN(parseFloat(e))},x.isNaN=function(e){return x.isNumber(e)&&e!=+e},x.isBoolean=function(e){return!0===e||!1===e||"[object Boolean]"==d.call(e)},x.isNull=function(e){return null===e},x.isUndefined=function(e){return void 0===e},x.has=function(e,t){return h.call(e,t)},x.noConflict=function(){return e._=t,this},x.identity=function(e){return e},x.times=function(e,t,i){for(var n=Array(e),r=0;r<e;r++)n[r]=t.call(i,r);return n},x.random=function(e,t){return null==t&&(t=e,e=0),e+Math.floor(Math.random()*(t-e+1))};var P={escape:{"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","/":"&#x2F;"}};P.unescape=x.invert(P.escape);var G={escape:RegExp("["+x.keys(P.escape).join("")+"]","g"),unescape:RegExp("("+x.keys(P.unescape).join("|")+")","g")};x.each(["escape","unescape"],function(t){x[t]=function(e){return null==e?"":(""+e).replace(G[t],function(e){return P[t][e]})}}),x.result=function(e,t){if(null==e)return null;t=e[t];return x.isFunction(t)?t.call(e):t},x.mixin=function(i){I(x.functions(i),function(e){var t=x[e]=i[e];x.prototype[e]=function(){var e=[this._wrapped];return o.apply(e,arguments),L.call(this,t.apply(x,e))}})};var T=0;x.uniqueId=function(e){var t=++T+"";return e?e+t:t},x.templateSettings={evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g,escape:/<%-([\s\S]+?)%>/g};var A=/(.)^/,O={"'":"'","\\":"\\","\r":"r","\n":"n","\t":"t","\u2028":"u2028","\u2029":"u2029"},M=/\\|'|\r|\n|\t|\u2028|\u2029/g;x.template=function(o,e,t){var i;t=x.defaults({},t,x.templateSettings);var n=RegExp([(t.escape||A).source,(t.interpolate||A).source,(t.evaluate||A).source].join("|")+"|$","g"),s=0,a="__p+='";o.replace(n,function(e,t,i,n,r){return a+=o.slice(s,r).replace(M,function(e){return"\\"+O[e]}),t&&(a+="'+\n((__t=("+t+"))==null?'':_.escape(__t))+\n'"),i&&(a+="'+\n((__t=("+i+"))==null?'':__t)+\n'"),n&&(a+="';\n"+n+"\n__p+='"),s=r+e.length,e}),a+="';\n",a="var __t,__p='',__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,'');};\n"+(a=!t.variable?"with(obj||{}){\n"+a+"}\n":a)+"return __p;\n";try{i=Function(t.variable||"obj","_",a)}catch(e){throw e.source=a,e}if(e)return i(e,x);e=function(e){return i.call(this,e,x)};return e.source="function("+(t.variable||"obj")+"){\n"+a+"}",e},x.chain=function(e){return x(e).chain()};var L=function(e){return this._chain?x(e).chain():e};x.mixin(x),I(["pop","push","reverse","shift","sort","splice","unshift"],function(t){var i=r[t];x.prototype[t]=function(){var e=this._wrapped;return i.apply(e,arguments),"shift"!=t&&"splice"!=t||0!==e.length||delete e[0],L.call(this,e)}}),I(["concat","join","slice"],function(e){var t=r[e];x.prototype[e]=function(){return L.call(this,t.apply(this._wrapped,arguments))}}),x.extend(x.prototype,{chain:function(){return this._chain=!0,this},value:function(){return this._wrapped}})}.call(this),function(){var e=this,t=e.Backbone,i=[],p=i.push,r=i.slice,f=i.splice,s="undefined"!=typeof exports?exports:e.Backbone={};s.VERSION="1.0.0";var g=e._;g||"undefined"==typeof require||(g=require("underscore")),s.$=e.jQuery||e.Zepto||e.ender||e.$,s.noConflict=function(){return e.Backbone=t,this},s.emulateHTTP=!1,s.emulateJSON=!1;var o=s.Events={on:function(e,t,i){return u(this,"on",e,[t,i])&&t&&(this._events||(this._events={}),(this._events[e]||(this._events[e]=[])).push({callback:t,context:i,ctx:i||this})),this},once:function(e,t,i){if(!u(this,"once",e,[t,i])||!t)return this;var n=this,r=g.once(function(){n.off(e,r),t.apply(this,arguments)});return r._callback=t,this.on(e,r,i)},off:function(e,t,i){var n,r,o,s,a,l,h,d;if(!this._events||!u(this,"off",e,[t,i]))return this;if(!e&&!t&&!i)return this._events={},this;for(a=0,l=(s=e?[e]:g.keys(this._events)).length;a<l;a++)if(e=s[a],o=this._events[e]){if(this._events[e]=n=[],t||i)for(h=0,d=o.length;h<d;h++)r=o[h],(t&&t!==r.callback&&t!==r.callback._callback||i&&i!==r.context)&&n.push(r);n.length||delete this._events[e]}return this},trigger:function(e){if(!this._events)return this;var t=r.call(arguments,1);if(!u(this,"trigger",e,t))return this;var i=this._events[e],n=this._events.all;return i&&a(i,t),n&&a(n,arguments),this},stopListening:function(e,t,i){var n=this._listeners;if(!n)return this;var r,o=!t&&!i;for(r in"object"==typeof t&&(i=this),e&&((n={})[e._listenerId]=e),n)n[r].off(t,i,this),o&&delete this._listeners[r];return this}},l=/\s+/,u=function(e,t,i,n){if(!i)return!0;if("object"==typeof i){for(var r in i)e[t].apply(e,[r,i[r]].concat(n));return!1}if(l.test(i)){for(var o=i.split(l),s=0,a=o.length;s<a;s++)e[t].apply(e,[o[s]].concat(n));return!1}return!0},a=function(e,t){var i,n=-1,r=e.length,o=t[0],s=t[1],a=t[2];switch(t.length){case 0:for(;++n<r;)(i=e[n]).callback.call(i.ctx);return;case 1:for(;++n<r;)(i=e[n]).callback.call(i.ctx,o);return;case 2:for(;++n<r;)(i=e[n]).callback.call(i.ctx,o,s);return;case 3:for(;++n<r;)(i=e[n]).callback.call(i.ctx,o,s,a);return;default:for(;++n<r;)(i=e[n]).callback.apply(i.ctx,t)}};g.each({listenTo:"on",listenToOnce:"once"},function(n,e){o[e]=function(e,t,i){return((this._listeners||(this._listeners={}))[e._listenerId||(e._listenerId=g.uniqueId("l"))]=e)[n](t,i="object"==typeof t?this:i,this),this}}),o.bind=o.on,o.unbind=o.off,g.extend(s,o);var n=s.Model=function(e,t){var i,n=e||{};t=t||{},this.cid=g.uniqueId("c"),this.attributes={},g.extend(this,g.pick(t,h)),t.parse&&(n=this.parse(n,t)||{}),(i=g.result(this,"defaults"))&&(n=g.defaults({},n,i)),this.set(n,t),this.changed={},this.initialize.apply(this,arguments)},h=["url","urlRoot","collection"];g.extend(n.prototype,o,{changed:null,validationError:null,idAttribute:"id",initialize:function(){},toJSON:function(e){return g.clone(this.attributes)},sync:function(){return s.sync.apply(this,arguments)},get:function(e){return this.attributes[e]},escape:function(e){return g.escape(this.get(e))},has:function(e){return null!=this.get(e)},set:function(e,t,i){var n,r,o,s,a,l,h;if(null==e)return this;if("object"==typeof e?(r=e,i=t):(r={})[e]=t,!this._validate(r,i=i||{}))return!1;for(n in o=i.unset,a=i.silent,s=[],e=this._changing,this._changing=!0,e||(this._previousAttributes=g.clone(this.attributes),this.changed={}),h=this.attributes,l=this._previousAttributes,this.idAttribute in r&&(this.id=r[this.idAttribute]),r)t=r[n],g.isEqual(h[n],t)||s.push(n),g.isEqual(l[n],t)?delete this.changed[n]:this.changed[n]=t,o?delete h[n]:h[n]=t;if(!a){s.length&&(this._pending=!0);for(var d=0,u=s.length;d<u;d++)this.trigger("change:"+s[d],this,h[s[d]],i)}if(e)return this;if(!a)for(;this._pending;)this._pending=!1,this.trigger("change",this,i);return this._pending=!1,this._changing=!1,this},unset:function(e,t){return this.set(e,void 0,g.extend({},t,{unset:!0}))},clear:function(e){var t,i={};for(t in this.attributes)i[t]=void 0;return this.set(i,g.extend({},e,{unset:!0}))},hasChanged:function(e){return null==e?!g.isEmpty(this.changed):g.has(this.changed,e)},changedAttributes:function(e){if(!e)return!!this.hasChanged()&&g.clone(this.changed);var t,i,n=!1,r=this._changing?this._previousAttributes:this.attributes;for(i in e)g.isEqual(r[i],t=e[i])||((n=n||{})[i]=t);return n},previous:function(e){return null!=e&&this._previousAttributes?this._previousAttributes[e]:null},previousAttributes:function(){return g.clone(this._previousAttributes)},fetch:function(t){void 0===(t=t?g.clone(t):{}).parse&&(t.parse=!0);var i=this,n=t.success;return t.success=function(e){if(!i.set(i.parse(e,t),t))return!1;n&&n(i,e,t),i.trigger("sync",i,e,t)},G(this,t),this.sync("read",this,t)},save:function(e,t,i){var n,r=this.attributes;if(null==e||"object"==typeof e?(n=e,i=t):(n={})[e]=t,n&&(!i||!i.wait)&&!this.set(n,i))return!1;if(i=g.extend({validate:!0},i),!this._validate(n,i))return!1;n&&i.wait&&(this.attributes=g.extend({},r,n)),void 0===i.parse&&(i.parse=!0);var o=this,s=i.success;return i.success=function(e){o.attributes=r;var t=o.parse(e,i);if(i.wait&&(t=g.extend(n||{},t)),g.isObject(t)&&!o.set(t,i))return!1;s&&s(o,e,i),o.trigger("sync",o,e,i)},G(this,i),"patch"==(t=this.isNew()?"create":i.patch?"patch":"update")&&(i.attrs=n),t=this.sync(t,this,i),n&&i.wait&&(this.attributes=r),t},destroy:function(t){t=t?g.clone(t):{};function i(){n.trigger("destroy",n,n.collection,t)}var n=this,r=t.success;if(t.success=function(e){(t.wait||n.isNew())&&i(),r&&r(n,e,t),n.isNew()||n.trigger("sync",n,e,t)},this.isNew())return t.success(),!1;G(this,t);var e=this.sync("delete",this,t);return t.wait||i(),e},url:function(){var e=g.result(this,"urlRoot")||g.result(this.collection,"url")||P();return this.isNew()?e:e+("/"===e.charAt(e.length-1)?"":"/")+encodeURIComponent(this.id)},parse:function(e,t){return e},clone:function(){return new this.constructor(this.attributes)},isNew:function(){return null==this.id},isValid:function(e){return this._validate({},g.extend(e||{},{validate:!0}))},_validate:function(e,t){if(!t.validate||!this.validate)return!0;e=g.extend({},this.attributes,e);e=this.validationError=this.validate(e,t)||null;return!e||(this.trigger("invalid",this,e,g.extend(t||{},{validationError:e})),!1)}});g.each(["keys","values","pairs","invert","pick","omit"],function(t){n.prototype[t]=function(){var e=r.call(arguments);return e.unshift(this.attributes),g[t].apply(g,e)}});var d=s.Collection=function(e,t){(t=t||{}).url&&(this.url=t.url),t.model&&(this.model=t.model),void 0!==t.comparator&&(this.comparator=t.comparator),this._reset(),this.initialize.apply(this,arguments),e&&this.reset(e,g.extend({silent:!0},t))},m={add:!0,remove:!0,merge:!0},c={add:!0,merge:!1,remove:!1};g.extend(d.prototype,o,{model:n,initialize:function(){},toJSON:function(t){return this.map(function(e){return e.toJSON(t)})},sync:function(){return s.sync.apply(this,arguments)},add:function(e,t){return this.set(e,g.defaults(t||{},c))},remove:function(e,t){var i,n,r,o;for(t=t||{},i=0,n=(e=g.isArray(e)?e.slice():[e]).length;i<n;i++)(o=this.get(e[i]))&&(delete this._byId[o.id],delete this._byId[o.cid],r=this.indexOf(o),this.models.splice(r,1),this.length--,t.silent||(t.index=r,o.trigger("remove",o,this,t)),this._removeReference(o));return this},set:function(e,t){var i,n,r;(t=g.defaults(t||{},m)).parse&&(e=this.parse(e,t)),g.isArray(e)||(e=e?[e]:[]);for(var o=t.at,s=this.comparator&&null==o&&!1!==t.sort,a=g.isString(this.comparator)?this.comparator:null,l=[],h=[],d={},u=0,c=e.length;u<c;u++)(i=this._prepareModel(e[u],t))&&((n=this.get(i))?(t.remove&&(d[n.cid]=!0),t.merge&&(n.set(i.attributes,t),s&&!r&&n.hasChanged(a)&&(r=!0))):t.add&&(l.push(i),i.on("all",this._onModelEvent,this),null!=(this._byId[i.cid]=i).id&&(this._byId[i.id]=i)));if(t.remove){for(u=0,c=this.length;u<c;++u)d[(i=this.models[u]).cid]||h.push(i);h.length&&this.remove(h,t)}if(l.length&&(s&&(r=!0),this.length+=l.length,null!=o?f.apply(this.models,[o,0].concat(l)):p.apply(this.models,l)),r&&this.sort({silent:!0}),t.silent)return this;for(u=0,c=l.length;u<c;u++)(i=l[u]).trigger("add",i,this,t);return r&&this.trigger("sort",this,t),this},reset:function(e,t){t=t||{};for(var i=0,n=this.models.length;i<n;i++)this._removeReference(this.models[i]);return t.previousModels=this.models,this._reset(),this.add(e,g.extend({silent:!0},t)),t.silent||this.trigger("reset",this,t),this},push:function(e,t){return e=this._prepareModel(e,t),this.add(e,g.extend({at:this.length},t)),e},pop:function(e){var t=this.at(this.length-1);return this.remove(t,e),t},unshift:function(e,t){return e=this._prepareModel(e,t),this.add(e,g.extend({at:0},t)),e},shift:function(e){var t=this.at(0);return this.remove(t,e),t},slice:function(e,t){return this.models.slice(e,t)},get:function(e){if(null!=e)return this._byId[null!=e.id?e.id:e.cid||e]},at:function(e){return this.models[e]},where:function(i,e){return g.isEmpty(i)?e?void 0:[]:this[e?"find":"filter"](function(e){for(var t in i)if(i[t]!==e.get(t))return!1;return!0})},findWhere:function(e){return this.where(e,!0)},sort:function(e){if(!this.comparator)throw new Error("Cannot sort a set without a comparator");return e=e||{},g.isString(this.comparator)||1===this.comparator.length?this.models=this.sortBy(this.comparator,this):this.models.sort(g.bind(this.comparator,this)),e.silent||this.trigger("sort",this,e),this},sortedIndex:function(e,t,i){t=t||this.comparator;var n=g.isFunction(t)?t:function(e){return e.get(t)};return g.sortedIndex(this.models,e,n,i)},pluck:function(e){return g.invoke(this.models,"get",e)},fetch:function(i){void 0===(i=i?g.clone(i):{}).parse&&(i.parse=!0);var n=i.success,r=this;return i.success=function(e){var t=i.reset?"reset":"set";r[t](e,i),n&&n(r,e,i),r.trigger("sync",r,e,i)},G(this,i),this.sync("read",this,i)},create:function(t,i){if(i=i?g.clone(i):{},!(t=this._prepareModel(t,i)))return!1;i.wait||this.add(t,i);var n=this,r=i.success;return i.success=function(e){i.wait&&n.add(t,i),r&&r(t,e,i)},t.save(null,i),t},parse:function(e,t){return e},clone:function(){return new this.constructor(this.models)},_reset:function(){this.length=0,this.models=[],this._byId={}},_prepareModel:function(e,t){if(e instanceof n)return e.collection||(e.collection=this),e;var i=new((t=t||{}).collection=this).model(e,t);return i._validate(e,t)?i:(this.trigger("invalid",this,e,t),!1)},_removeReference:function(e){this===e.collection&&delete e.collection,e.off("all",this._onModelEvent,this)},_onModelEvent:function(e,t,i,n){("add"!==e&&"remove"!==e||i===this)&&("destroy"===e&&this.remove(t,n),t&&e==="change:"+t.idAttribute&&(delete this._byId[t.previous(t.idAttribute)],null!=t.id&&(this._byId[t.id]=t)),this.trigger.apply(this,arguments))}});g.each(["forEach","each","map","collect","reduce","foldl","inject","reduceRight","foldr","find","detect","filter","select","reject","every","all","some","any","include","contains","invoke","max","min","toArray","size","first","head","take","initial","rest","tail","drop","last","without","indexOf","shuffle","lastIndexOf","isEmpty","chain"],function(t){d.prototype[t]=function(){var e=r.call(arguments);return e.unshift(this.models),g[t].apply(g,e)}});g.each(["groupBy","countBy","sortBy"],function(n){d.prototype[n]=function(t,e){var i=g.isFunction(t)?t:function(e){return e.get(t)};return g[n](this.models,i,e)}});var v=s.View=function(e){this.cid=g.uniqueId("view"),this._configure(e||{}),this._ensureElement(),this.initialize.apply(this,arguments),this.delegateEvents()},w=/^(\S+)\s*(.*)$/,b=["model","collection","el","id","attributes","className","tagName","events"];g.extend(v.prototype,o,{tagName:"div",$:function(e){return this.$el.find(e)},initialize:function(){},render:function(){return this},remove:function(){return this.$el.remove(),this.stopListening(),this},setElement:function(e,t){return this.$el&&this.undelegateEvents(),this.$el=e instanceof s.$?e:s.$(e),this.el=this.$el[0],!1!==t&&this.delegateEvents(),this},delegateEvents:function(e){if(!(e=e||g.result(this,"events")))return this;for(var t in this.undelegateEvents(),e){var i,n=e[t];(n=!g.isFunction(n)?this[e[t]]:n)&&(t=(i=t.match(w))[1],i=i[2],n=g.bind(n,this),t+=".delegateEvents"+this.cid,""===i?this.$el.on(t,n):this.$el.on(t,i,n))}return this},undelegateEvents:function(){return this.$el.off(".delegateEvents"+this.cid),this},_configure:function(e){this.options&&(e=g.extend({},g.result(this,"options"),e)),g.extend(this,g.pick(e,b)),this.options=e},_ensureElement:function(){var e;this.el?this.setElement(g.result(this,"el"),!1):(e=g.extend({},g.result(this,"attributes")),this.id&&(e.id=g.result(this,"id")),this.className&&(e.class=g.result(this,"className")),e=s.$("<"+g.result(this,"tagName")+">").attr(e),this.setElement(e,!1))}}),s.sync=function(e,t,i){var n=y[e];g.defaults(i=i||{},{emulateHTTP:s.emulateHTTP,emulateJSON:s.emulateJSON});var r,o={type:n,dataType:"json"};i.url||(o.url=g.result(t,"url")||P()),null!=i.data||!t||"create"!==e&&"update"!==e&&"patch"!==e||(o.contentType="application/json",o.data=JSON.stringify(i.attrs||t.toJSON(i))),i.emulateJSON&&(o.contentType="application/x-www-form-urlencoded",o.data=o.data?{model:o.data}:{}),!i.emulateHTTP||"PUT"!==n&&"DELETE"!==n&&"PATCH"!==n||(o.type="POST",i.emulateJSON&&(o.data._method=n),r=i.beforeSend,i.beforeSend=function(e){if(e.setRequestHeader("X-HTTP-Method-Override",n),r)return r.apply(this,arguments)}),"GET"===o.type||i.emulateJSON||(o.processData=!1),"PATCH"!==o.type||!window.ActiveXObject||window.external&&window.external.msActiveXFilteringEnabled||(o.xhr=function(){return new ActiveXObject("Microsoft.XMLHTTP")});o=i.xhr=s.ajax(g.extend(o,i));return t.trigger("request",t,o,i),o};var y={create:"POST",update:"PUT",patch:"PATCH",delete:"DELETE",read:"GET"};s.ajax=function(){return s.$.ajax.apply(s.$,arguments)};var i=s.Router=function(e){(e=e||{}).routes&&(this.routes=e.routes),this._bindRoutes(),this.initialize.apply(this,arguments)},k=/\((.*?)\)/g,x=/(\(\?)?:\w+/g,I=/\*\w+/g,_=/[\-{}\[\]+?.,\\\^$|#\s]/g;g.extend(i.prototype,o,{initialize:function(){},route:function(t,i,n){g.isRegExp(t)||(t=this._routeToRegExp(t)),g.isFunction(i)&&(n=i,i=""),n=n||this[i];var r=this;return s.history.route(t,function(e){e=r._extractParameters(t,e);n&&n.apply(r,e),r.trigger.apply(r,["route:"+i].concat(e)),r.trigger("route",i,e),s.history.trigger("route",r,i,e)}),this},navigate:function(e,t){return s.history.navigate(e,t),this},_bindRoutes:function(){if(this.routes){this.routes=g.result(this,"routes");for(var e,t=g.keys(this.routes);null!=(e=t.pop());)this.route(e,this.routes[e])}},_routeToRegExp:function(e){return e=e.replace(_,"\\$&").replace(k,"(?:$1)?").replace(x,function(e,t){return t?e:"([^/]+)"}).replace(I,"(.*?)"),new RegExp("^"+e+"$")},_extractParameters:function(e,t){t=e.exec(t).slice(1);return g.map(t,function(e){return e?decodeURIComponent(e):null})}});var $=s.History=function(){this.handlers=[],g.bindAll(this,"checkUrl"),"undefined"!=typeof window&&(this.location=window.location,this.history=window.history)},E=/^[#\/]|\s+$/g,S=/^\/+|\/+$/g,C=/msie [\w.]+/,N=/\/$/;$.started=!1,g.extend($.prototype,o,{interval:50,getHash:function(e){e=(e||this).location.href.match(/#(.*)$/);return e?e[1]:""},getFragment:function(e,t){return null==e&&(this._hasPushState||!this._wantsHashChange||t?(e=this.location.pathname,t=this.root.replace(N,""),e.indexOf(t)||(e=e.substr(t.length))):e=this.getHash()),e.replace(E,"")},start:function(e){if($.started)throw new Error("Backbone.history has already been started");$.started=!0,this.options=g.extend({},{root:"/"},this.options,e),this.root=this.options.root,this._wantsHashChange=!1!==this.options.hashChange,this._wantsPushState=!!this.options.pushState,this._hasPushState=!!(this.options.pushState&&this.history&&this.history.pushState);var t=this.getFragment(),e=document.documentMode,e=C.exec(navigator.userAgent.toLowerCase())&&(!e||e<=7);this.root=("/"+this.root+"/").replace(S,"/"),e&&this._wantsHashChange&&(this.iframe=s.$('<iframe src="javascript:0" tabindex="-1" />').hide().appendTo("body")[0].contentWindow,this.navigate(t)),this._hasPushState?s.$(window).on("popstate",this.checkUrl):this._wantsHashChange&&"onhashchange"in window&&!e?s.$(window).on("hashchange",this.checkUrl):this._wantsHashChange&&(this._checkUrlInterval=setInterval(this.checkUrl,this.interval)),this.fragment=t;e=this.location,t=e.pathname.replace(/[^\/]$/,"$&/")===this.root;return this._wantsHashChange&&this._wantsPushState&&!this._hasPushState&&!t?(this.fragment=this.getFragment(null,!0),this.location.replace(this.root+this.location.search+"#"+this.fragment),!0):(this._wantsPushState&&this._hasPushState&&t&&e.hash&&(this.fragment=this.getHash().replace(E,""),this.history.replaceState({},document.title,this.root+this.fragment+e.search)),this.options.silent?void 0:this.loadUrl())},stop:function(){s.$(window).off("popstate",this.checkUrl).off("hashchange",this.checkUrl),clearInterval(this._checkUrlInterval),$.started=!1},route:function(e,t){this.handlers.unshift({route:e,callback:t})},checkUrl:function(e){var t=this.getFragment();if((t=t===this.fragment&&this.iframe?this.getFragment(this.getHash(this.iframe)):t)===this.fragment)return!1;this.iframe&&this.navigate(t),this.loadUrl()||this.loadUrl(this.getHash())},loadUrl:function(e){var t=this.fragment=this.getFragment(e);return g.any(this.handlers,function(e){if(e.route.test(t))return e.callback(t),!0})},navigate:function(e,t){if(!$.started)return!1;if(t&&!0!==t||(t={trigger:t}),e=this.getFragment(e||""),this.fragment!==e){this.fragment=e;var i=this.root+e;if(this._hasPushState)this.history[t.replace?"replaceState":"pushState"]({},document.title,i);else{if(!this._wantsHashChange)return this.location.assign(i);this._updateHash(this.location,e,t.replace),this.iframe&&e!==this.getFragment(this.getHash(this.iframe))&&(t.replace||this.iframe.document.open().close(),this._updateHash(this.iframe.location,e,t.replace))}t.trigger&&this.loadUrl(e)}},_updateHash:function(e,t,i){i?(i=e.href.replace(/(javascript:|#).*$/,""),e.replace(i+"#"+t)):e.hash="#"+t}}),s.history=new $;n.extend=d.extend=i.extend=v.extend=$.extend=function(e,t){var i=this,n=e&&g.has(e,"constructor")?e.constructor:function(){return i.apply(this,arguments)};g.extend(n,i,t);t=function(){this.constructor=n};return t.prototype=i.prototype,n.prototype=new t,e&&g.extend(n.prototype,e),n.__super__=i.prototype,n};var P=function(){throw new Error('A "url" property or function must be specified')},G=function(t,i){var n=i.error;i.error=function(e){n&&n(t,e,i),t.trigger("error",t,e,i)}}}.call(this),function(){var i=this._,r=this.Backbone;function t(){return(65536*(1+Math.random())|0).toString(16).substring(1)}r.LocalStorage=window.Store=function(e){this.name=e;e=this.localStorage().getItem(this.name);this.records=e&&e.split(",")||[]},i.extend(r.LocalStorage.prototype,{save:function(){this.localStorage().setItem(this.name,this.records.join(","))},create:function(e){return e.id||(e.id=t()+t()+"-"+t()+"-"+t()+"-"+t()+"-"+t()+t()+t(),e.set(e.idAttribute,e.id)),this.localStorage().setItem(this.name+"-"+e.id,JSON.stringify(e)),this.records.push(e.id.toString()),this.save(),e},update:function(e){return this.localStorage().setItem(this.name+"-"+e.id,JSON.stringify(e)),i.include(this.records,e.id.toString())||this.records.push(e.id.toString()),this.save(),e},find:function(e){return JSON.parse(this.localStorage().getItem(this.name+"-"+e.id))},findAll:function(){return i(this.records).chain().map(function(e){return JSON.parse(this.localStorage().getItem(this.name+"-"+e))},this).compact().value()},destroy:function(t){return this.localStorage().removeItem(this.name+"-"+t.id),this.records=i.reject(this.records,function(e){return e==t.id.toString()}),this.save(),t},localStorage:function(){return localStorage}}),r.LocalStorage.sync=window.Store.sync=r.localSync=function(e,t,i,n){var r,o=t.localStorage||t.collection.localStorage;switch("function"==typeof i&&(i={success:i,error:n}),e){case"read":r=null!=t.id?o.find(t):o.findAll();break;case"create":r=o.create(t);break;case"update":r=o.update(t);break;case"delete":r=o.destroy(t)}r?i.success(r):i.error("Record not found")},r.ajaxSync=r.sync,r.getSyncMethod=function(e){return e.localStorage||e.collection&&e.collection.localStorage?r.localSync:r.ajaxSync},r.sync=function(e,t,i,n){return r.getSyncMethod(t).apply(this,[e,t,i,n])}}(),function(){for(var n,a,r={8:"backspace",9:"tab",13:"enter",16:"shift",17:"ctrl",18:"alt",20:"capslock",27:"esc",32:"space",33:"pageup",34:"pagedown",35:"end",36:"home",37:"left",38:"up",39:"right",40:"down",45:"ins",46:"del",91:"meta",93:"meta",224:"meta"},t={106:"*",107:"+",109:"-",110:".",111:"/",186:";",187:"=",188:",",189:"-",190:".",191:"/",192:"`",219:"[",220:"\\",221:"]",222:"'"},d={"~":"`","!":"1","@":"2","#":"3",$:"4","%":"5","^":"6","&":"7","*":"8","(":"9",")":"0",_:"-","+":"=",":":";",'"':"'","<":",",">":".","?":"/","|":"\\"},u={option:"alt",command:"meta",return:"enter",escape:"esc"},c={},o={},p={},l=!1,h=!1,e=1;e<20;++e)r[111+e]="f"+e;for(e=0;e<=9;++e)r[e+96]=e;function i(e,t,i){if(e.addEventListener)return e.addEventListener(t,i,!1);e.attachEvent("on"+t,i)}function f(e){return"keypress"==e.type?String.fromCharCode(e.which):r[e.which]||t[e.which]||String.fromCharCode(e.which).toLowerCase()}function g(e){e=e||{};var t,i=!1;for(t in p)e[t]?i=!0:p[t]=0;i||(h=!1)}function m(e,t,i,n,r){var o,s,a,l,h=[],d=i.type;if(!c[e])return[];for("keyup"==d&&w(e)&&(t=[e]),o=0;o<c[e].length;++o)(s=c[e][o]).seq&&p[s.seq]!=s.level||d==s.action&&(("keypress"!=d||i.metaKey||i.ctrlKey)&&(a=t,l=s.modifiers,a.sort().join(",")!==l.sort().join(","))||(n&&s.combo==r&&c[e].splice(o,1),h.push(s)));return h}function v(e,t){!1===e(t)&&(t.preventDefault&&t.preventDefault(),t.stopPropagation&&t.stopPropagation(),t.returnValue=!1,t.cancelBubble=!0)}function s(e){e.which="number"==typeof e.which?e.which:e.keyCode;var t=f(e);t&&("keyup"!=e.type||l!=t?function(e,t){if(n=(i=(n=t).target||n.srcElement).tagName,-1<(" "+i.className+" ").indexOf(" mousetrap ")||!("INPUT"==n||"SELECT"==n||"TEXTAREA"==n||i.contentEditable&&"true"==i.contentEditable)){for(var i,n,r=m(e,(n=[],(i=t).shiftKey&&n.push("shift"),i.altKey&&n.push("alt"),i.ctrlKey&&n.push("ctrl"),i.metaKey&&n.push("meta"),n),t),o={},s=!1,a=0;a<r.length;++a)r[a].seq?(s=!0,o[r[a].seq]=1,v(r[a].callback,t)):s||h||v(r[a].callback,t);t.type!=h||w(e)||g(o)}}(t,e):l=!1)}function w(e){return"shift"==e||"ctrl"==e||"alt"==e||"meta"==e}function b(e,t,i){return i="keypress"==(i=i||(function(){if(!n)for(var e in n={},r)95<e&&e<112||r.hasOwnProperty(e)&&(n[r[e]]=e);return n}()[e]?"keydown":"keypress"))&&t.length?"keydown":i}function y(t,e,i,n){p[t]=0,n=n||b(e[0],[]);function r(e){h=n,++p[t],clearTimeout(a),a=setTimeout(g,1e3)}function o(e){v(i,e),"keyup"!==n&&(l=f(e)),setTimeout(g,10)}for(var s=0;s<e.length;++s)k(e[s],s<e.length-1?r:o,n,t,s)}function k(e,t,i,n,r){var o,s,a,l=(e=e.replace(/\s+/g," ")).split(" "),h=[];if(1<l.length)return y(e,l,t,i),0;for(a="+"===e?["+"]:e.split("+"),o=0;o<a.length;++o)s=a[o],u[s]&&(s=u[s]),i&&"keypress"!=i&&d[s]&&(s=d[s],h.push("shift")),w(s)&&h.push(s);i=b(s,h,i),c[s]||(c[s]=[]),m(s,h,{type:i},!n,e),c[s][n?"unshift":"push"]({callback:t,modifiers:h,action:i,seq:n,level:r,combo:e})}i(document,"keypress",s),i(document,"keydown",s),i(document,"keyup",s);var x={bind:function(e,t,i){return function(e,t,i){for(var n=0;n<e.length;++n)k(e[n],t,i)}(e instanceof Array?e:[e],t,i),o[e+":"+i]=t,this},unbind:function(e,t){return o[e+":"+t]&&(delete o[e+":"+t],this.bind(e,function(){},t)),this},trigger:function(e,t){return o[e+":"+t](),this},reset:function(){return c={},o={},this}};window.Mousetrap=x,"function"==typeof define&&define.amd&&define("mousetrap",function(){return x})}(),function(ye,ke,xe){var e,Ie={beforeShow:i,move:i,change:i,show:i,hide:i,color:!1,flat:!1,showInput:!1,showButtons:!0,clickoutFiresChange:!1,showInitial:!1,showPalette:!1,showPaletteOnly:!1,showSelectionPalette:!0,localStorageKey:!1,appendTo:"body",maxSelectionSize:7,cancelText:"cancel",chooseText:"choose",preferredFormat:!1,className:"",showAlpha:!1,theme:"sp-light",palette:["fff","000"],selectionPalette:[],disabled:!1},_e=[],$e=!!/msie/i.exec(ye.navigator.userAgent),Ee=((e=document.createElement("div").style).cssText="background-color:rgba(0,0,0,.5)",t(e.backgroundColor,"rgba")||t(e.backgroundColor,"hsla")),Se=["<div class='sp-replacer'>","<div class='sp-preview'><div class='sp-preview-inner'></div></div>","<div class='sp-dd'>&#9660;</div>","</div>"].join(""),Ce=function(){var e="";if($e)for(var t=1;t<=6;t++)e+="<div class='sp-"+t+"'></div>";return["<div class='sp-container sp-hidden'>","<div class='sp-palette-container'>","<div class='sp-palette sp-thumb sp-cf'></div>","</div>","<div class='sp-picker-container'>","<div class='sp-top sp-cf'>","<div class='sp-fill'></div>","<div class='sp-top-inner'>","<div class='sp-color'>","<div class='sp-sat'>","<div class='sp-val'>","<div class='sp-dragger'></div>","</div>","</div>","</div>","<div class='sp-hue'>","<div class='sp-slider'></div>",e,"</div>","</div>","<div class='sp-alpha'><div class='sp-alpha-inner'><div class='sp-alpha-handle'></div></div></div>","</div>","<div class='sp-input-container sp-cf'>","<input class='sp-input' type='text' spellcheck='false'  />","</div>","<div class='sp-initial sp-thumb sp-cf'></div>","<div class='sp-button-container sp-cf'>","<a class='sp-cancel' href='#'></a>","<button class='sp-choose'></button>","</div>","</div>","</div>"].join("")}();function t(e,t){return!!~(""+e).indexOf(t)}function Ne(e,t,i){for(var n=[],r=0;r<e.length;r++){var o=tinycolor(e[r]),s=o.toHsl().l<.5?"sp-thumb-el sp-thumb-dark":"sp-thumb-el sp-thumb-light";s+=tinycolor.equals(t,e[r])?" sp-thumb-active":"";var a=Ee?"background-color:"+o.toRgbString():"filter:"+o.toFilter();n.push('<span title="'+o.toRgbString()+'" data-color="'+o.toRgbString()+'" class="'+s+'"><span class="sp-thumb-inner" style="'+a+';" /></span>')}return"<div class='sp-cf "+i+"'>"+n.join("")+"</div>"}function o(e,t){var i,n,r,o,s,a=(s=t,t=e,(s=ke.extend({},Ie,s)).callbacks={move:Ge(s.move,t),change:Ge(s.change,t),show:Ge(s.show,t),hide:Ge(s.hide,t),beforeShow:Ge(s.beforeShow,t)},s),l=a.flat,h=a.showSelectionPalette,d=a.localStorageKey,t=a.theme,u=a.callbacks,c=(i=ve,function(){var e=this,t=arguments;r&&clearTimeout(o),!r&&o||(o=setTimeout(function(){o=null,i.apply(e,t)},n))}),p=!(n=10),f=0,g=0,m=0,v=0,w=0,b=0,y=0,k=0,x=0,I=0,_=1,s=a.palette.slice(0),$=ke.isArray(s[0])?s:[s],E=a.selectionPalette.slice(0),S=a.maxSelectionSize,C="sp-dragging",N=e.ownerDocument,P=(N.body,ke(e)),G=!1,T=ke(Ce,N).addClass(t),A=T.find(".sp-color"),O=T.find(".sp-dragger"),M=T.find(".sp-hue"),L=T.find(".sp-slider"),z=T.find(".sp-alpha-inner"),R=T.find(".sp-alpha"),F=T.find(".sp-alpha-handle"),j=T.find(".sp-input"),B=T.find(".sp-palette"),V=T.find(".sp-initial"),D=T.find(".sp-cancel"),H=T.find(".sp-choose"),U=P.is("input"),q=U&&!l,J=q?ke(Se).addClass(t).addClass(a.className):ke([]),X=q?J:P,Y=J.find(".sp-preview-inner"),W=a.color||U&&P.val(),K=!1,Q=a.preferredFormat,Z=Q,ee=!a.showButtons||a.clickoutFiresChange;function te(){T.toggleClass("sp-flat",l),T.toggleClass("sp-input-disabled",!a.showInput),T.toggleClass("sp-alpha-enabled",a.showAlpha),T.toggleClass("sp-buttons-disabled",!a.showButtons||l),T.toggleClass("sp-palette-disabled",!a.showPalette),T.toggleClass("sp-palette-only",a.showPaletteOnly),T.toggleClass("sp-initial-disabled",!a.showInitial),T.addClass(a.className),ve()}function ie(e){if(h){e=tinycolor(e).toRgbString();if(-1===ke.inArray(e,E))for(E.push(e);E.length>S;)E.shift();if(d&&ye.localStorage)try{ye.localStorage[d]=E.join(";")}catch(e){}}}function ne(){var i=ce(),e=ke.map($,function(e,t){return Ne(e,i,"sp-palette-row sp-palette-row-"+t)});E&&e.push(Ne(function(){var e,t=[],i=E,n={};if(a.showPalette){for(var r=0;r<$.length;r++)for(var o=0;o<$[r].length;o++)n[e=tinycolor($[r][o]).toRgbString()]=!0;for(r=0;r<i.length;r++)e=tinycolor(i[r]).toRgbString(),n.hasOwnProperty(e)||(t.push(i[r]),n[e]=!0)}return t.reverse().slice(0,a.maxSelectionSize)}(),i,"sp-palette-row sp-palette-row-selection")),B.html(e.join(""))}function re(){var e,t;a.showInitial&&(e=K,t=ce(),V.html(Ne([e,t],t,"sp-palette-row-initial")))}function oe(){(g<=0||f<=0||v<=0)&&ve(),T.addClass(C)}function se(){T.removeClass(C)}function ae(){var e=tinycolor(j.val());e.ok?ue(e):j.addClass("sp-validation-error")}function le(){(p?de:he)()}function he(){var e=ke.Event("beforeShow.spectrum");p?ve():(P.trigger(e,[ce()]),!1===u.beforeShow(ce())||e.isDefaultPrevented()||(function(){for(var e=0;e<_e.length;e++)_e[e]&&_e[e].hide()}(),p=!0,ke(N).bind("click.spectrum",de),ke(ye).bind("resize.spectrum",c),J.addClass("sp-active"),T.removeClass("sp-hidden"),a.showPalette&&ne(),ve(),fe(),K=ce(),re(),u.show(K),P.trigger("show.spectrum",[K])))}function de(e){e&&"click"==e.type&&2==e.button||p&&!l&&(p=!1,ke(N).unbind("click.spectrum",de),ke(ye).unbind("resize.spectrum",c),J.removeClass("sp-active"),T.addClass("sp-hidden"),tinycolor.equals(ce(),K)||(ee&&"cancel"!==e?me(!0):ue(K,!0)),u.hide(ce()),P.trigger("hide.spectrum",[ce()]))}function ue(e,t){var i;tinycolor.equals(e,ce())||(e=(i=tinycolor(e)).toHsv(),k=e.h,x=e.s,I=e.v,_=e.a,fe(),i.ok&&!t&&(Z=Q||i.format))}function ce(e){return e=e||{},tinycolor.fromRatio({h:k,s:x,v:I,a:Math.round(100*_)/100},{format:e.format||Z})}function pe(){fe(),u.move(ce()),P.trigger("move.spectrum",[ce()])}function fe(){j.removeClass("sp-validation-error"),ge();var e=tinycolor.fromRatio({h:k,s:1,v:1});A.css("background-color",e.toHexString());var t=Z;_<1&&("hex"!==t&&"hex3"!==t&&"hex6"!==t&&"name"!==t||(t="rgb"));var i=ce({format:t}),n=i.toHexString(),r=i.toRgbString();Ee||1===i.alpha?Y.css("background-color",r):(Y.css("background-color","transparent"),Y.css("filter",i.toFilter())),a.showAlpha&&((e=i.toRgb()).a=0,e="linear-gradient(left, "+(r=tinycolor(e).toRgbString())+", "+n+")",$e?z.css("filter",tinycolor(r).toFilter({gradientType:1},n)):(z.css("background","-webkit-"+e),z.css("background","-moz-"+e),z.css("background","-ms-"+e),z.css("background",e))),a.showInput&&j.val(i.toString(t)),a.showPalette&&ne(),re()}function ge(){var e=x*f,t=g-I*g,e=Math.max(-m,Math.min(f-m,e-m)),t=Math.max(-m,Math.min(g-m,t-m));O.css({top:t,left:e});e=_*w;F.css({left:e-b/2});e=k*v;L.css({top:e-y})}function me(e){var t=ce();U&&P.val(t.toString(Z)).change();var i=!tinycolor.equals(t,K);ie(K=t),e&&i&&(u.change(t),P.trigger("change.spectrum",[t]))}function ve(){var e,t,i,n,r,o,s;f=A.width(),g=A.height(),m=O.height(),M.width(),v=M.height(),y=L.height(),w=R.width(),b=F.width(),l||(T.css("position","absolute"),T.offset((t=X,i=(e=T).outerWidth(),n=e.outerHeight(),r=t.outerHeight(),o=e[0].ownerDocument,s=o.documentElement,e=s.clientWidth+ke(o).scrollLeft(),o=s.clientHeight+ke(o).scrollTop(),(t=t.offset()).top+=r,t.left-=Math.min(t.left,t.left+i>e&&i<e?Math.abs(t.left+i-e):0),t.top-=Math.min(t.top,t.top+n>o&&n<o?Math.abs(+(n+r)):0),t))),ge()}function we(){de(),G=!0,P.attr("disabled",!0),X.addClass("sp-disabled")}!function(){var e;if($e&&T.find("*:not(input)").attr("unselectable","on"),te(),q&&P.after(J).hide(),l?P.after(T).hide():(e=1!==(e="parent"===a.appendTo?P.parent():ke(a.appendTo)).length?ke("body"):e).append(T),d&&ye.localStorage){try{var t=ye.localStorage[d].split(",#");1<t.length&&(delete ye.localStorage[d],ke.each(t,function(e,t){ie(t)}))}catch(e){}try{E=ye.localStorage[d].split(";")}catch(e){}}function i(e){return e.data&&e.data.ignore?(ue(ke(this).data("color")),pe()):(ue(ke(this).data("color")),me(!0),pe(),de()),!1}X.bind("click.spectrum touchstart.spectrum",function(e){G||le(),e.stopPropagation(),ke(e.target).is("input")||e.preventDefault()}),!P.is(":disabled")&&!0!==a.disabled||we(),T.click(Pe),j.change(ae),j.bind("paste",function(){setTimeout(ae,1)}),j.keydown(function(e){13==e.keyCode&&ae()}),D.text(a.cancelText),D.bind("click.spectrum",function(e){e.stopPropagation(),e.preventDefault(),de("cancel")}),H.text(a.chooseText),H.bind("click.spectrum",function(e){e.stopPropagation(),e.preventDefault(),j.hasClass("sp-validation-error")||(me(!0),de())}),Te(R,function(e,t,i){_=e/w,i.shiftKey&&(_=Math.round(10*_)/10),pe()}),Te(M,function(e,t){k=parseFloat(t/v),pe()},oe,se),Te(A,function(e,t){x=parseFloat(e/f),I=parseFloat((g-t)/g),pe()},oe,se),W?(ue(W),fe(),Z=Q||tinycolor(W).format,ie(W)):fe(),l&&he(),t=$e?"mousedown.spectrum":"click.spectrum touchstart.spectrum",B.delegate(".sp-thumb-el",t,i),V.delegate(".sp-thumb-el:nth-child(1)",t,{ignore:!0},i)}();var be={show:he,hide:de,toggle:le,reflow:ve,option:function(e,t){return e===xe?ke.extend({},a):t===xe?a[e]:(a[e]=t,void te())},enable:function(){G=!1,P.attr("disabled",!1),X.removeClass("sp-disabled")},disable:we,set:function(e){ue(e),me()},get:ce,destroy:function(){P.show(),X.unbind("click.spectrum touchstart.spectrum"),T.remove(),J.remove(),_e[be.id]=null},container:T};return be.id=_e.push(be)-1,be}function i(){}function Pe(e){e.stopPropagation()}function Ge(e,t){var i=Array.prototype.slice,n=i.call(arguments,2);return function(){return e.apply(t,n.concat(i.call(arguments)))}}function Te(n,r,i,e){r=r||function(){},i=i||function(){},e=e||function(){};var o=n.ownerDocument||document,s=!1,a={},l=0,h=0,d="ontouchstart"in ye,u={};function c(e){e.stopPropagation&&e.stopPropagation(),e.preventDefault&&e.preventDefault(),e.returnValue=!1}function p(e){if(s){if($e&&document.documentMode<9&&!e.button)return f();var t=e.originalEvent.touches,i=(t?t[0]:e).pageX,t=(t?t[0]:e).pageY,i=Math.max(0,Math.min(i-a.left,h)),t=Math.max(0,Math.min(t-a.top,l));d&&c(e),r.apply(n,[i,t,e])}}function f(){s&&(ke(o).unbind(u),ke(o.body).removeClass("sp-dragging"),e.apply(n,arguments)),s=!1}u.selectstart=c,u.dragstart=c,u[d?"touchmove":"mousemove"]=p,u[d?"touchend":"mouseup"]=f,ke(n).bind(d?"touchstart":"mousedown",function(e){var t=e.which?3==e.which:2==e.button;e.originalEvent.touches,t||s||!1!==i.apply(n,arguments)&&(s=!0,l=ke(n).height(),h=ke(n).width(),a=ke(n).offset(),ke(o).bind(u),ke(o.body).addClass("sp-dragging"),d||p(e),c(e))})}var s="spectrum.id";ke.fn.spectrum=function(i,e){if("string"!=typeof i)return this.spectrum("destroy").each(function(){var e=o(this,i);ke(this).data(s,e.id)});var n=this,r=Array.prototype.slice.call(arguments,1);return this.each(function(){var e=_e[ke(this).data(s)];if(e){var t=e[i];if(!t)throw new Error("Spectrum: no such method: '"+i+"'");"get"==i?n=e.get():"container"==i?n=e.container:"option"==i?n=e.option.apply(e,r):"destroy"==i?(e.destroy(),ke(this).removeData(s)):t.apply(e,r)}}),n},ke.fn.spectrum.load=!0,ke.fn.spectrum.loadOpts={},ke.fn.spectrum.draggable=Te,ke.fn.spectrum.defaults=Ie,ke.spectrum={},ke.spectrum.localization={},ke.spectrum.palettes={},ke.fn.spectrum.processNativeColorInputs=function(){var e=ke("<input type='color' value='!' />")[0];"color"===e.type&&"!"!=e.value||ke("input[type=color]").spectrum({preferredFormat:"hex6"})},function(e){var o=/^[\s,#]+/,u=/\s+$/,i=0,c=Math,r=c.round,p=c.min,f=c.max,t=c.random;function g(e,s){if(s=s||{},"object"==typeof(e=e||"")&&e.hasOwnProperty("_tc_id"))return e;var t=function(e){var t={r:0,g:0,b:0},i=1,n=!1,r=!1;"string"==typeof e&&(e=function(e){e=e.replace(o,"").replace(u,"").toLowerCase();var t,i=!1;if(b[e])e=b[e],i=!0;else if("transparent"==e)return{r:0,g:0,b:0,a:0};if(t=$.rgb.exec(e))return{r:t[1],g:t[2],b:t[3]};if(t=$.rgba.exec(e))return{r:t[1],g:t[2],b:t[3],a:t[4]};if(t=$.hsl.exec(e))return{h:t[1],s:t[2],l:t[3]};if(t=$.hsla.exec(e))return{h:t[1],s:t[2],l:t[3],a:t[4]};if(t=$.hsv.exec(e))return{h:t[1],s:t[2],v:t[3]};if(t=$.hex6.exec(e))return{r:x(t[1]),g:x(t[2]),b:x(t[3]),format:i?"name":"hex"};if(t=$.hex3.exec(e))return{r:x(t[1]+""+t[1]),g:x(t[2]+""+t[2]),b:x(t[3]+""+t[3]),format:i?"name":"hex"};return!1}(e));"object"==typeof e&&(e.hasOwnProperty("r")&&e.hasOwnProperty("g")&&e.hasOwnProperty("b")?(t=function(e,t,i){return{r:255*k(e,255),g:255*k(t,255),b:255*k(i,255)}}(e.r,e.g,e.b),n=!0,r="%"===String(e.r).substr(-1)?"prgb":"rgb"):e.hasOwnProperty("h")&&e.hasOwnProperty("s")&&e.hasOwnProperty("v")?(e.s=_(e.s),e.v=_(e.v),t=function(e,t,i){e=6*k(e,360),t=k(t,100),i=k(i,100);var n=c.floor(e),r=e-n,o=i*(1-t),e=i*(1-r*t),t=i*(1-(1-r)*t),n=n%6;return{r:255*[i,e,o,o,t,i][n],g:255*[t,i,i,e,o,o][n],b:255*[o,o,t,i,i,e][n]}}(e.h,e.s,e.v),n=!0,r="hsv"):e.hasOwnProperty("h")&&e.hasOwnProperty("s")&&e.hasOwnProperty("l")&&(e.s=_(e.s),e.l=_(e.l),t=function(e,t,i){var n,r,o;function s(e,t,i){return i<0&&(i+=1),1<i&&--i,i<1/6?e+6*(t-e)*i:i<.5?t:i<2/3?e+(t-e)*(2/3-i)*6:e}e=k(e,360),t=k(t,100),i=k(i,100),0===t?n=r=o=i:(n=s(t=2*i-(i=i<.5?i*(1+t):i+t-i*t),i,e+1/3),r=s(t,i,e),o=s(t,i,e-1/3));return{r:255*n,g:255*r,b:255*o}}(e.h,e.s,e.l),n=!0,r="hsl"),e.hasOwnProperty("a")&&(i=e.a));i=parseFloat(i),(isNaN(i)||i<0||1<i)&&(i=1);return{ok:n,format:e.format||r,r:p(255,f(t.r,0)),g:p(255,f(t.g,0)),b:p(255,f(t.b,0)),a:i}}(e),a=t.r,l=t.g,h=t.b,d=t.a,n=r(100*d)/100,e=s.format||t.format;return a<1&&(a=r(a)),l<1&&(l=r(l)),h<1&&(h=r(h)),{ok:t.ok,format:e,_tc_id:i++,alpha:d,toHsv:function(){var e=v(a,l,h);return{h:360*e.h,s:e.s,v:e.v,a:d}},toHsvString:function(){var e=v(a,l,h),t=r(360*e.h),i=r(100*e.s),e=r(100*e.v);return 1==d?"hsv("+t+", "+i+"%, "+e+"%)":"hsva("+t+", "+i+"%, "+e+"%, "+n+")"},toHsl:function(){var e=m(a,l,h);return{h:360*e.h,s:e.s,l:e.l,a:d}},toHslString:function(){var e=m(a,l,h),t=r(360*e.h),i=r(100*e.s),e=r(100*e.l);return 1==d?"hsl("+t+", "+i+"%, "+e+"%)":"hsla("+t+", "+i+"%, "+e+"%, "+n+")"},toHex:function(e){return w(a,l,h,e)},toHexString:function(e){return"#"+w(a,l,h,e)},toRgb:function(){return{r:r(a),g:r(l),b:r(h),a:d}},toRgbString:function(){return 1==d?"rgb("+r(a)+", "+r(l)+", "+r(h)+")":"rgba("+r(a)+", "+r(l)+", "+r(h)+", "+n+")"},toPercentageRgb:function(){return{r:r(100*k(a,255))+"%",g:r(100*k(l,255))+"%",b:r(100*k(h,255))+"%",a:d}},toPercentageRgbString:function(){return 1==d?"rgb("+r(100*k(a,255))+"%, "+r(100*k(l,255))+"%, "+r(100*k(h,255))+"%)":"rgba("+r(100*k(a,255))+"%, "+r(100*k(l,255))+"%, "+r(100*k(h,255))+"%, "+n+")"},toName:function(){return y[w(a,l,h,!0)]||!1},toFilter:function(e){var t=w(a,l,h),i=t,n=Math.round(255*parseFloat(d)).toString(16),r=n,o=s&&s.gradientType?"GradientType = 1, ":"";return e&&(i=(e=g(e)).toHex(),r=Math.round(255*parseFloat(e.alpha)).toString(16)),"progid:DXImageTransform.Microsoft.gradient("+o+"startColorstr=#"+I(n)+t+",endColorstr=#"+I(r)+i+")"},toString:function(e){var t=!1;return"rgb"===(e=e||this.format)&&(t=this.toRgbString()),"prgb"===e&&(t=this.toPercentageRgbString()),"hex"!==e&&"hex6"!==e||(t=this.toHexString()),"hex3"===e&&(t=this.toHexString(!0)),"name"===e&&(t=this.toName()),"hsl"===e&&(t=this.toHslString()),(t="hsv"===e?this.toHsvString():t)||this.toHexString()}}}function m(e,t,i){e=k(e,255),t=k(t,255),i=k(i,255);var n,r=f(e,t,i),o=p(e,t,i),s=(r+o)/2;if(r==o)n=l=0;else{var a=r-o,l=.5<s?a/(2-r-o):a/(r+o);switch(r){case e:n=(t-i)/a+(t<i?6:0);break;case t:n=(i-e)/a+2;break;case i:n=(e-t)/a+4}n/=6}return{h:n,s:l,l:s}}function v(e,t,i){e=k(e,255),t=k(t,255),i=k(i,255);var n,r=f(e,t,i),o=p(e,t,i),s=r,a=r-o,l=0===r?0:a/r;if(r==o)n=0;else{switch(r){case e:n=(t-i)/a+(t<i?6:0);break;case t:n=(i-e)/a+2;break;case i:n=(e-t)/a+4}n/=6}return{h:n,s:l,v:s}}function w(e,t,i,n){i=[I(r(e).toString(16)),I(r(t).toString(16)),I(r(i).toString(16))];return n&&i[0].charAt(0)==i[0].charAt(1)&&i[1].charAt(0)==i[1].charAt(1)&&i[2].charAt(0)==i[2].charAt(1)?i[0].charAt(0)+i[1].charAt(0)+i[2].charAt(0):i.join("")}g.fromRatio=function(e,t){if("object"==typeof e){var i,n={};for(i in e)e.hasOwnProperty(i)&&(n[i]="a"===i?e[i]:_(e[i]));e=n}return g(e,t)},g.equals=function(e,t){return!(!e||!t)&&g(e).toRgbString()==g(t).toRgbString()},g.random=function(){return g.fromRatio({r:t(),g:t(),b:t()})},g.desaturate=function(e,t){e=g(e).toHsl();return e.s-=(t||10)/100,e.s=n(e.s),g(e)},g.saturate=function(e,t){e=g(e).toHsl();return e.s+=(t||10)/100,e.s=n(e.s),g(e)},g.greyscale=function(e){return g.desaturate(e,100)},g.lighten=function(e,t){e=g(e).toHsl();return e.l+=(t||10)/100,e.l=n(e.l),g(e)},g.darken=function(e,t){e=g(e).toHsl();return e.l-=(t||10)/100,e.l=n(e.l),g(e)},g.complement=function(e){e=g(e).toHsl();return e.h=(e.h+180)%360,g(e)},g.triad=function(e){var t=g(e).toHsl(),i=t.h;return[g(e),g({h:(i+120)%360,s:t.s,l:t.l}),g({h:(i+240)%360,s:t.s,l:t.l})]},g.tetrad=function(e){var t=g(e).toHsl(),i=t.h;return[g(e),g({h:(i+90)%360,s:t.s,l:t.l}),g({h:(i+180)%360,s:t.s,l:t.l}),g({h:(i+270)%360,s:t.s,l:t.l})]},g.splitcomplement=function(e){var t=g(e).toHsl(),i=t.h;return[g(e),g({h:(i+72)%360,s:t.s,l:t.l}),g({h:(i+216)%360,s:t.s,l:t.l})]},g.analogous=function(e,t,i){t=t||6,i=i||30;var n=g(e).toHsl(),r=360/i,o=[g(e)];for(n.h=(n.h-(r*t>>1)+720)%360;--t;)n.h=(n.h+r)%360,o.push(g(n));return o},g.monochromatic=function(e,t){t=t||6;for(var e=g(e).toHsv(),i=e.h,n=e.s,r=e.v,o=[],s=1/t;t--;)o.push(g({h:i,s:n,v:r})),r=(r+s)%1;return o},g.readability=function(e,t){var i=g(e).toRgb(),n=g(t).toRgb(),e=(299*i.r+587*i.g+114*i.b)/1e3,t=(299*n.r+587*n.g+114*n.b)/1e3,n=Math.max(i.r,n.r)-Math.min(i.r,n.r)+Math.max(i.g,n.g)-Math.min(i.g,n.g)+Math.max(i.b,n.b)-Math.min(i.b,n.b);return{brightness:Math.abs(e-t),color:n}},g.readable=function(e,t){t=g.readability(e,t);return 125<t.brightness&&500<t.color},g.mostReadable=function(e,t){for(var i=null,n=0,r=!1,o=0;o<t.length;o++){var s=g.readability(e,t[o]),a=125<s.brightness&&500<s.color,s=s.brightness/125*3+s.color/500;(a&&!r||a&&r&&n<s||!a&&!r&&n<s)&&(r=a,n=s,i=g(t[o]))}return i};var b=g.names={aliceblue:"f0f8ff",antiquewhite:"faebd7",aqua:"0ff",aquamarine:"7fffd4",azure:"f0ffff",beige:"f5f5dc",bisque:"ffe4c4",black:"000",blanchedalmond:"ffebcd",blue:"00f",blueviolet:"8a2be2",brown:"a52a2a",burlywood:"deb887",burntsienna:"ea7e5d",cadetblue:"5f9ea0",chartreuse:"7fff00",chocolate:"d2691e",coral:"ff7f50",cornflowerblue:"6495ed",cornsilk:"fff8dc",crimson:"dc143c",cyan:"0ff",darkblue:"00008b",darkcyan:"008b8b",darkgoldenrod:"b8860b",darkgray:"a9a9a9",darkgreen:"006400",darkgrey:"a9a9a9",darkkhaki:"bdb76b",darkmagenta:"8b008b",darkolivegreen:"556b2f",darkorange:"ff8c00",darkorchid:"9932cc",darkred:"8b0000",darksalmon:"e9967a",darkseagreen:"8fbc8f",darkslateblue:"483d8b",darkslategray:"2f4f4f",darkslategrey:"2f4f4f",darkturquoise:"00ced1",darkviolet:"9400d3",deeppink:"ff1493",deepskyblue:"00bfff",dimgray:"696969",dimgrey:"696969",dodgerblue:"1e90ff",firebrick:"b22222",floralwhite:"fffaf0",forestgreen:"228b22",fuchsia:"f0f",gainsboro:"dcdcdc",ghostwhite:"f8f8ff",gold:"ffd700",goldenrod:"daa520",gray:"808080",green:"008000",greenyellow:"adff2f",grey:"808080",honeydew:"f0fff0",hotpink:"ff69b4",indianred:"cd5c5c",indigo:"4b0082",ivory:"fffff0",khaki:"f0e68c",lavender:"e6e6fa",lavenderblush:"fff0f5",lawngreen:"7cfc00",lemonchiffon:"fffacd",lightblue:"add8e6",lightcoral:"f08080",lightcyan:"e0ffff",lightgoldenrodyellow:"fafad2",lightgray:"d3d3d3",lightgreen:"90ee90",lightgrey:"d3d3d3",lightpink:"ffb6c1",lightsalmon:"ffa07a",lightseagreen:"20b2aa",lightskyblue:"87cefa",lightslategray:"789",lightslategrey:"789",lightsteelblue:"b0c4de",lightyellow:"ffffe0",lime:"0f0",limegreen:"32cd32",linen:"faf0e6",magenta:"f0f",maroon:"800000",mediumaquamarine:"66cdaa",mediumblue:"0000cd",mediumorchid:"ba55d3",mediumpurple:"9370db",mediumseagreen:"3cb371",mediumslateblue:"7b68ee",mediumspringgreen:"00fa9a",mediumturquoise:"48d1cc",mediumvioletred:"c71585",midnightblue:"191970",mintcream:"f5fffa",mistyrose:"ffe4e1",moccasin:"ffe4b5",navajowhite:"ffdead",navy:"000080",oldlace:"fdf5e6",olive:"808000",olivedrab:"6b8e23",orange:"ffa500",orangered:"ff4500",orchid:"da70d6",palegoldenrod:"eee8aa",palegreen:"98fb98",paleturquoise:"afeeee",palevioletred:"db7093",papayawhip:"ffefd5",peachpuff:"ffdab9",peru:"cd853f",pink:"ffc0cb",plum:"dda0dd",powderblue:"b0e0e6",purple:"800080",red:"f00",rosybrown:"bc8f8f",royalblue:"4169e1",saddlebrown:"8b4513",salmon:"fa8072",sandybrown:"f4a460",seagreen:"2e8b57",seashell:"fff5ee",sienna:"a0522d",silver:"c0c0c0",skyblue:"87ceeb",slateblue:"6a5acd",slategray:"708090",slategrey:"708090",snow:"fffafa",springgreen:"00ff7f",steelblue:"4682b4",tan:"d2b48c",teal:"008080",thistle:"d8bfd8",tomato:"ff6347",turquoise:"40e0d0",violet:"ee82ee",wheat:"f5deb3",white:"fff",whitesmoke:"f5f5f5",yellow:"ff0",yellowgreen:"9acd32"},y=g.hexNames=function(e){var t,i={};for(t in e)e.hasOwnProperty(t)&&(i[e[t]]=t);return i}(b);function k(e,t){"string"==typeof(i=e)&&-1!=i.indexOf(".")&&1===parseFloat(i)&&(e="100%");var i,i="string"==typeof(i=e)&&-1!=i.indexOf("%");return e=p(t,f(0,parseFloat(e))),i&&(e=parseInt(e*t,10)/100),c.abs(e-t)<1e-6?1:e%t/parseFloat(t)}function n(e){return p(1,f(0,e))}function x(e){return parseInt(e,16)}function I(e){return 1==e.length?"0"+e:""+e}function _(e){return e=e<=1?100*e+"%":e}var s,a,$=(a="[\\s|\\(]+("+(s="(?:[-\\+]?\\d*\\.\\d+%?)|(?:[-\\+]?\\d+%?)")+")[,|\\s]+("+s+")[,|\\s]+("+s+")\\s*\\)?",s="[\\s|\\(]+("+s+")[,|\\s]+("+s+")[,|\\s]+("+s+")[,|\\s]+("+s+")\\s*\\)?",{rgb:new RegExp("rgb"+a),rgba:new RegExp("rgba"+s),hsl:new RegExp("hsl"+a),hsla:new RegExp("hsla"+s),hsv:new RegExp("hsv"+a),hex3:/^([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})$/,hex6:/^([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})$/});e.tinycolor=g}(this),ke(function(){ke.fn.spectrum.load&&ke.fn.spectrum.processNativeColorInputs()})}(window,jQuery),function(t){var e,i,n;function r(e,t){var i,n;1<e.originalEvent.touches.length||(e.preventDefault(),i=e.originalEvent.changedTouches[0],(n=document.createEvent("MouseEvents")).initMouseEvent(t,!0,!0,window,1,i.screenX,i.screenY,i.clientX,i.clientY,!1,!1,!1,!1,0,null),e.target.dispatchEvent(n))}t.support.touch="ontouchend"in document,t.support.touch&&(e=t.ui.mouse.prototype,i=e._mouseInit,e._touchStart=function(e){!n&&this._mouseCapture(e.originalEvent.changedTouches[0])&&(n=!0,this._touchMoved=!1,r(e,"mouseover"),r(e,"mousemove"),r(e,"mousedown"))},e._touchMove=function(e){n&&(this._touchMoved=!0,r(e,"mousemove"))},e._touchEnd=function(e){n&&(r(e,"mouseup"),r(e,"mouseout"),this._touchMoved||r(e,"click"),n=!1)},e._mouseInit=function(){var e=this;e.element.bind("touchstart",t.proxy(e,"_touchStart")).bind("touchmove",t.proxy(e,"_touchMove")).bind("touchend",t.proxy(e,"_touchEnd")),i.call(e)})}(jQuery),Array.indexOf||(Array.prototype.indexOf=function(e,t){for(var i=t||0;i<this.length;i++)if(this[i]===e)return i;return-1});var Parser=function(e){function h(e){function t(){}return t.prototype=e,new t}function d(e,t,i,n){this.type_=e,this.index_=t||0,this.prio_=i||0,this.number_=null!=n?n:0,this.toString=function(){switch(this.type_){case 0:return this.number_;case 1:case 2:case 3:return this.index_;case 4:return"CALL";default:return"Invalid Token"}}}function u(e,t,i,n){this.tokens=e,this.ops1=t,this.ops2=i,this.functions=n}var c=/[\\\'\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,p={"\b":"\\b","\t":"\\t","\n":"\\n","\f":"\\f","\r":"\\r","'":"\\'","\\":"\\\\"};function t(e,t){return Number(e)+Number(t)}function i(e,t){return e-t}function n(e,t){return e*t}function r(e,t){return e/t}function o(e,t){return e%t}function s(e,t){return""+e+t}function a(e){return-e}function l(e){return Math.random()*(e||1)}function f(e){for(var t=e=Math.floor(e);1<e;)t*=--e;return t}function g(e,t){return Math.sqrt(e*e+t*t)}function m(e,t){return"[object Array]"!=Object.prototype.toString.call(e)?[e,t]:((e=e.slice()).push(t),e)}function v(){this.success=!1,this.errormsg="",this.expression="",this.pos=0,this.tokennumber=0,this.tokenprio=0,this.tokenindex=0,this.tmpprio=0,this.ops1={sin:Math.sin,cos:Math.cos,tan:Math.tan,asin:Math.asin,acos:Math.acos,atan:Math.atan,sqrt:Math.sqrt,log:Math.log,abs:Math.abs,ceil:Math.ceil,floor:Math.floor,round:Math.round,"-":a,exp:Math.exp},this.ops2={"+":t,"-":i,"*":n,"/":r,"%":o,"^":Math.pow,",":m,"||":s},this.functions={random:l,fac:f,min:Math.min,max:Math.max,pyt:g,pow:Math.pow,atan2:Math.atan2},this.consts={E:Math.E,PI:Math.PI}}u.prototype={simplify:function(e){e=e||{};for(var t,i,n=[],r=[],o=this.tokens.length,s=0,s=0;s<o;s++){var a,l=(a=this.tokens[s]).type_;if(0===l)n.push(a);else if(3===l&&a.index_ in e)a=new d(0,0,0,e[a.index_]),n.push(a);else if(2===l&&1<n.length)i=n.pop(),t=n.pop(),a=new d(0,0,0,(0,this.ops2[a.index_])(t.number_,i.number_)),n.push(a);else if(1===l&&0<n.length)t=n.pop(),a=new d(0,0,0,(0,this.ops1[a.index_])(t.number_)),n.push(a);else{for(;0<n.length;)r.push(n.shift());r.push(a)}}for(;0<n.length;)r.push(n.shift());return new u(r,h(this.ops1),h(this.ops2),h(this.functions))},substitute:function(e,t){t instanceof u||(t=(new v).parse(String(t)));for(var i,n=[],r=this.tokens.length,o=0,o=0;o<r;o++)if(3===(i=this.tokens[o]).type_&&i.index_===e)for(var s=0;s<t.tokens.length;s++){var a=t.tokens[s],a=new d(a.type_,a.index_,a.prio_,a.number_);n.push(a)}else n.push(i);return new u(n,h(this.ops1),h(this.ops2),h(this.functions))},evaluate:function(e){e=e||{};for(var t,i,n,r=[],o=this.tokens.length,s=0,s=0;s<o;s++){var a,l=(a=this.tokens[s]).type_;if(0===l)r.push(a.number_);else if(2===l)i=r.pop(),t=r.pop(),n=this.ops2[a.index_],r.push(n(t,i));else if(3===l)if(a.index_ in e)r.push(e[a.index_]);else{if(!(a.index_ in this.functions))throw new Error("undefined variable: "+a.index_);r.push(this.functions[a.index_])}else if(1===l)t=r.pop(),n=this.ops1[a.index_],r.push(n(t));else{if(4!==l)throw new Error("invalid Expression");if(t=r.pop(),!(n=r.pop()).apply||!n.call)throw new Error(n+" is not a function");"[object Array]"==Object.prototype.toString.call(t)?r.push(n.apply(void 0,t)):r.push(n.call(void 0,t))}}if(1<r.length)throw new Error("invalid Expression (parity)");return r[0]},toString:function(e){for(var t,i,n,r=[],o=this.tokens.length,s=0,s=0;s<o;s++){var a,l=(a=this.tokens[s]).type_;if(0===l)r.push("string"==typeof(n=a.number_)?(c.lastIndex=0,c.test(n)?"'"+n.replace(c,function(e){var t=p[e];return"string"==typeof t?t:"\\u"+("0000"+e.charCodeAt(0).toString(16)).slice(-4)})+"'":"'"+n+"'"):n);else if(2===l)n=r.pop(),t=r.pop(),i=a.index_,e&&"^"==i?r.push("Math.pow("+t+","+n+")"):r.push("("+t+i+n+")");else if(3===l)r.push(a.index_);else if(1===l)t=r.pop(),"-"===(i=a.index_)?r.push("("+i+t+")"):r.push(i+"("+t+")");else{if(4!==l)throw new Error("invalid Expression");t=r.pop(),i=r.pop(),r.push(i+"("+t+")")}}if(1<r.length)throw new Error("invalid Expression (parity)");return r[0]},variables:function(){for(var e=this.tokens.length,t=[],i=0;i<e;i++){var n=this.tokens[i];3===n.type_&&-1==t.indexOf(n.index_)&&t.push(n.index_)}return t},toJSFunction:function(e,t){return new Function(e,"with(Parser.values) { return "+this.simplify(t).toString(!0)+"; }")}},v.parse=function(e){return(new v).parse(e)},v.evaluate=function(e,t){return v.parse(e).evaluate(t)},v.Expression=u,v.values={sin:Math.sin,cos:Math.cos,tan:Math.tan,asin:Math.asin,acos:Math.acos,atan:Math.atan,sqrt:Math.sqrt,log:Math.log,abs:Math.abs,ceil:Math.ceil,floor:Math.floor,round:Math.round,random:l,fac:f,exp:Math.exp,min:Math.min,max:Math.max,pyt:g,pow:Math.pow,atan2:Math.atan2,E:Math.E,PI:Math.PI};return v.prototype={parse:function(e){this.errormsg="",this.success=!0;var t,i,n=[],r=[],o=77,s=this.tmpprio=0;for(this.expression=e,this.pos=0;this.pos<this.expression.length;)this.isOperator()?this.isSign()&&64&o?(this.isNegativeSign()&&(this.tokenprio=2,this.tokenindex="-",s++,this.addfunc(r,n,1)),o=77):this.isComment()||(0==(2&o)&&this.error_parsing(this.pos,"unexpected operator"),s+=2,this.addfunc(r,n,2),o=77):this.isNumber()?(0==(1&o)&&this.error_parsing(this.pos,"unexpected number"),t=new d(0,0,0,this.tokennumber),r.push(t),o=50):this.isString()?(0==(1&o)&&this.error_parsing(this.pos,"unexpected string"),t=new d(0,0,0,this.tokennumber),r.push(t),o=50):this.isLeftParenth()?(0==(8&o)&&this.error_parsing(this.pos,'unexpected "("'),128&o&&(s+=2,this.tokenprio=-2,this.tokenindex=-1,this.addfunc(r,n,4)),o=333):this.isRightParenth()?(256&o?(t=new d(0,0,0,[]),r.push(t)):0==(16&o)&&this.error_parsing(this.pos,'unexpected ")"'),o=186):this.isComma()?(0==(32&o)&&this.error_parsing(this.pos,'unexpected ","'),this.addfunc(r,n,2),s+=2,o=77):this.isConst()?(0==(1&o)&&this.error_parsing(this.pos,"unexpected constant"),i=new d(0,0,0,this.tokennumber),r.push(i),o=50):this.isOp2()?(0==(4&o)&&this.error_parsing(this.pos,"unexpected function"),this.addfunc(r,n,2),s+=2,o=8):this.isOp1()?(0==(4&o)&&this.error_parsing(this.pos,"unexpected function"),this.addfunc(r,n,1),s++,o=8):this.isVar()?(0==(1&o)&&this.error_parsing(this.pos,"unexpected variable"),i=new d(3,this.tokenindex,0,0),r.push(i),o=186):this.isWhite()||(""===this.errormsg?this.error_parsing(this.pos,"unknown character"):this.error_parsing(this.pos,this.errormsg));for((this.tmpprio<0||10<=this.tmpprio)&&this.error_parsing(this.pos,'unmatched "()"');0<n.length;){var a=n.pop();r.push(a)}return s+1!==r.length&&this.error_parsing(this.pos,"parity"),new u(r,h(this.ops1),h(this.ops2),h(this.functions))},evaluate:function(e,t){return this.parse(e).evaluate(t)},error_parsing:function(e,t){throw this.success=!1,this.errormsg="parse error [column "+e+"]: "+t,new Error(this.errormsg)},addfunc:function(e,t,i){for(var n=new d(i,this.tokenindex,this.tokenprio+this.tmpprio,0);0<t.length&&n.prio_<=t[t.length-1].prio_;)e.push(t.pop());t.push(n)},isNumber:function(){for(var e=!1,t="";this.pos<this.expression.length;){var i=this.expression.charCodeAt(this.pos);if(!(48<=i&&i<=57||46===i))break;t+=this.expression.charAt(this.pos),this.pos++,this.tokennumber=parseFloat(t),e=!0}return e},unescape:function(e,t){for(var i=[],n=!1,r=0;r<e.length;r++){var o=e.charAt(r);if(n){switch(o){case"'":i.push("'");break;case"\\":i.push("\\");break;case"/":i.push("/");break;case"b":i.push("\b");break;case"f":i.push("\f");break;case"n":i.push("\n");break;case"r":i.push("\r");break;case"t":i.push("\t");break;case"u":var s=parseInt(e.substring(r+1,r+5),16);i.push(String.fromCharCode(s)),r+=4;break;default:throw this.error_parsing(t+r,"Illegal escape sequence: '\\"+o+"'")}n=!1}else"\\"==o?n=!0:i.push(o)}return i.join("")},isString:function(){var e=!1,t="",i=this.pos;if(this.pos<this.expression.length&&"'"==this.expression.charAt(this.pos))for(this.pos++;this.pos<this.expression.length;){if("'"==this.expression.charAt(this.pos)&&"\\"!=t.slice(-1)){this.pos++,this.tokennumber=this.unescape(t,i),e=!0;break}t+=this.expression.charAt(this.pos),this.pos++}return e},isConst:function(){for(var e in this.consts){var t=e.length;if(e===this.expression.substr(this.pos,t))return this.tokennumber=this.consts[e],this.pos+=t,!0}return!1},isOperator:function(){var e=this.expression.charCodeAt(this.pos);if(43===e)this.tokenprio=0,this.tokenindex="+";else if(45===e)this.tokenprio=0,this.tokenindex="-";else if(124===e){if(124!==this.expression.charCodeAt(this.pos+1))return!1;this.pos++,this.tokenprio=0,this.tokenindex="||"}else if(42===e)this.tokenprio=1,this.tokenindex="*";else if(47===e)this.tokenprio=2,this.tokenindex="/";else if(37===e)this.tokenprio=2,this.tokenindex="%";else{if(94!==e)return!1;this.tokenprio=3,this.tokenindex="^"}return this.pos++,!0},isSign:function(){var e=this.expression.charCodeAt(this.pos-1);return 45===e||43===e},isPositiveSign:function(){return 43===this.expression.charCodeAt(this.pos-1)},isNegativeSign:function(){return 45===this.expression.charCodeAt(this.pos-1)},isLeftParenth:function(){return 40===this.expression.charCodeAt(this.pos)&&(this.pos++,this.tmpprio+=10,!0)},isRightParenth:function(){return 41===this.expression.charCodeAt(this.pos)&&(this.pos++,this.tmpprio-=10,!0)},isComma:function(){return 44===this.expression.charCodeAt(this.pos)&&(this.pos++,this.tokenprio=-1,this.tokenindex=",",!0)},isWhite:function(){var e=this.expression.charCodeAt(this.pos);return(32===e||9===e||10===e||13===e)&&(this.pos++,!0)},isOp1:function(){for(var e="",t=this.pos;t<this.expression.length;t++){var i=this.expression.charAt(t);if(i.toUpperCase()===i.toLowerCase()&&(t===this.pos||"_"!=i&&(i<"0"||"9"<i)))break;e+=i}return 0<e.length&&e in this.ops1&&(this.tokenindex=e,this.tokenprio=5,this.pos+=e.length,!0)},isOp2:function(){for(var e="",t=this.pos;t<this.expression.length;t++){var i=this.expression.charAt(t);if(i.toUpperCase()===i.toLowerCase()&&(t===this.pos||"_"!=i&&(i<"0"||"9"<i)))break;e+=i}return 0<e.length&&e in this.ops2&&(this.tokenindex=e,this.tokenprio=5,this.pos+=e.length,!0)},isVar:function(){for(var e="",t=this.pos;t<this.expression.length;t++){var i=this.expression.charAt(t);if(i.toUpperCase()===i.toLowerCase()&&(t===this.pos||"_"!=i&&(i<"0"||"9"<i)))break;e+=i}return 0<e.length&&(this.tokenindex=e,this.tokenprio=4,this.pos+=e.length,!0)},isComment:function(){return 47===this.expression.charCodeAt(this.pos-1)&&42===this.expression.charCodeAt(this.pos)&&(this.pos=this.expression.indexOf("*/",this.pos)+2,1===this.pos&&(this.pos=this.expression.length),!0)}},e.Parser=v}("undefined"==typeof exports?{}:exports);$(function(){window.requestAnimationFrame=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(e){window.setTimeout(e,1e3/60)};var e=Backbone.View.extend({tagName:"div",className:"app",template:_.template('<div class="showpanel"><button class="button show-load icon-folder-open">app</button></div><div class="panel"><div class="choosepanel"><button class="button show-load icon-folder-open">app</button><button class="button close icon-cancel" title="close menu"></button></div><div class="menu menu-load"><div class="controls"><form class="loadfromgist"><input class="loadfromgistinput" name="loadfromgistinput" placeholder="load app from gist url" type="text" /><button class="loadfromgistsubmit icon-ok" type="submit">load</button></form></div><div class="listing"><button class="button newblank icon-doc" title="new blank app">new</button><div class="currentapp"></div><div class="localapps"><h1>Saved Apps</h1></div><div class="examples"><h1>Examples</h1></div></div></div></div>'),currentTemplate:_.template('<h1>Current App</h1><div class="info"><h2 title="url, click to edit" class="seturl editable"></h2><p title="title, click to edit" class="settitle editable"></p><p title="description, click to edit" class="setdescription editable"></p></div><div class="savecontrols"><button class="savelocal icon-install">save local</button><button class="forklocal icon-split" title="save as... copy app and save under a new name">fork</button><a class="savegist button icon-globe-1" href="https://gist.github.com/?filename=app.meemoo.json" target="_blank" rel="noopener noreferrer" title="save app to gist.github.com">save public</button><button class="deletelocal icon-trash" title="delete local app"></button></div><div class="permalink" title="last publicly saved version"></div>'),frameCount:0,NativeNodes:{},plugins:{},events:{"click .close":"closePanels","click .show-load":"showLoad","click .newblank":"newBlank","submit .loadfromgist":"loadFromGist","click .savelocal":"saveLocal","click .forklocal":"forkLocal","click .deletelocal":"deleteLocal","blur .settitle":"setTitle","blur .setdescription":"setDescription","blur .seturl":"setUrl"},initialize:function(){this.render(),$("body").prepend(this.el),this.closePanels(),this.once("allLoaded",this.loadLocalApps,this)},allLoaded:function(){this.trigger("allLoaded"),window.requestAnimationFrame(this.renderAnimationFrame.bind(this))},render:function(){return this.$el.html(this.template()),this},renderAnimationFrame:function(e){e=void 0!==e?e:Date.now(),window.requestAnimationFrame(this.renderAnimationFrame.bind(this)),this.graph&&this.graph.view&&this.graph.view.renderAnimationFrame(e)},graph:null,shownGraph:null,wireColors:["#FF9292","#00C2EE","#DCA761","#8BB0FF","#96BD6D","#E797D7","#29C6AD"],wireColorIndex:0,selectedPort:null,getWireColor:function(){var e=this.wireColors[this.wireColorIndex];return this.wireColorIndex++,this.wireColorIndex>this.wireColors.length-1&&(this.wireColorIndex=0),e},addMenu:function(e,t,i){var n=this,t=$('<div class="menu menu-'+e+'"></div>').append(t).hide();this.$(".panel").append(t);t=$('<button class="button show-'+e+'">'+e+"</button>").click(function(){n.showPanel(e)});i&&t.addClass(i),this.$(".showpanel").append(t),this.$(".choosepanel > .close").before(t.clone(!0))},addMenuSection:function(e,t,i){e=$("<h1>").text(e);this.$(".menu-"+i+" .listing").append(e,t)},loadGraph:function(e){return this.graph&&(this.graph.remove(),this.graph=null),this.wireColorIndex=0,this.graph=new Iframework.Graph(e),e.info&&e.info.title&&(document.title="Meemoo: "+e.info.title),this.updateCurrentInfo(),this.shownGraph=this.graph,this.graph},showGraph:function(e){this.shownGraph&&this.shownGraph.view&&this.shownGraph.view.$el.hide(),e.view||e.initializeView(),this.shownGraph=e,this.shownGraph.view.$el.show(),this.shownGraph.view.unhidden||(this.shownGraph.view.unhidden=!0,this.shownGraph.view.rerenderEdges())},gotMessage:function(e){if(Iframework.graph){var t=Iframework.graph.get("nodes").get(e.data.nodeid);if(t)for(var i in e.data)if(e.data.hasOwnProperty(i)){var n=e.data[i];switch(i){case"message":t.sendFromFrame(n);break;case"info":t.infoLoaded(n);break;case"addInput":t.addInput(n);break;case"addOutput":t.addOutput(n);break;case"stateReady":t.iframeLoaded();break;case"set":t.setValues(n)}}}},_exampleGraphs:[],_loadedExample:null,loadExampleApps:function(e){this._exampleGraphs=this._exampleGraphs.concat(e);for(var t="",i=0;i<e.length;i++){var n=e[i].info.url;n&&(t+='<a href="#example/'+n+'" title="'+e[i].info.title+": "+e[i].info.description+'">'+n+"</a> <br />")}this.$(".menu-load .examples").append(t),this.graph||(this._loadedExample?this.loadExample(this._loadedExample):this._loadedLocal||this._loadedLocal||this._loadedGist||this.newBlank())},loadExample:function(e){this._loadedExample=e;for(var t=0;t<this._exampleGraphs.length;t++)if(this._exampleGraphs[t].info.url===e)return this._loadedLocalApp=null,this.loadGraph(this._exampleGraphs[t]),this.analyze("load","example",e),!0},closePanels:function(){this.$(".showpanel").show(),this.$(".panel").hide(),this.$(".graph").css("right","0px"),this.$(".menu").hide()},showPanel:function(e){var t;this.$(".menu").hide(),this.$(".showpanel").hide(),this.$(".panel").show(),this.$(".graph").css("right","350px"),e&&(0<this.$(".menu-"+e).length?(this.$(".menu-"+e).show(),this.trigger("showmenu:"+e)):(t=this,_.delay(function(){t.$(".menu-"+e).show(),t.trigger("showmenu:"+e)},1e3)))},showLoad:function(){this.showPanel(),this.$(".menu-load").show()},loadFromGist:function(){var e=this.loadFromGistId(this.$(".loadfromgistinput").val());return e&&($(".loadfromgistinput").blur(),this.router&&this.router.navigate("gist/"+e),this.$(".loadfromgistinput").val("").attr("placeholder","loading..."),window.setTimeout(function(){this.$(".loadfromgistinput").attr("placeholder","load app from gist url")},1500)),!1},loadFromGistId:function(e){var t=(this._loadedGist=e).split("/");return 3<t.length&&"gist.github.com"===t[2]&&(e=t[t.length-1]),$.ajax({url:"https://api.github.com/gists/"+e,type:"GET",dataType:"jsonp"}).done(function(e){var t,i,n,r=[];for(t in e.data.files)!e.data.files.hasOwnProperty(t)||(i=JSON.parse(e.data.files[t].content))&&(n=e.data.html_url,i.info.parents&&i.info.parents.push||(i.info.parents=[]),-1===i.info.parents.indexOf(n)&&i.info.parents.push(n),r.push(i));0<r.length&&(Iframework.loadGraph(r[0]),Iframework.closePanels())}).fail(function(e){console.warn("gist load error",e)}),this.analyze("load","gist",e),e},loadLocalApps:function(){this._localApps=new Iframework.LocalApps,this._localApps.fetch({success:function(e){Iframework._localApps.each(function(e){e.initializeView()}),Iframework.graph||Iframework._loadedLocal&&Iframework.loadLocal(Iframework._loadedLocal)},error:function(e){console.warn("error loading local apps")}})},_loadedLocal:null,_loadedLocalApp:null,loadLocal:function(e){if(this._loadedLocal=e,this._localApps){e=this._localApps.getByUrl(e);return e?(e.load(),!0):(console.warn("Didn't find local app with matching url."),this.newBlank(),!1)}return!1},setKey:function(e){e=window.prompt("Enter a url key",e);return e&&(e=this.encodeKey(e),this.graph.setInfo("url",e)),e},encodeKey:function(e){return e=e.toLowerCase().replace(/ /g,"-"),e=encodeURIComponent(e)},saveLocal:function(){for(this.graph.get("info")||this.graph.set({info:{}});!this.graph.get("info").hasOwnProperty("url")||""===this.graph.get("info").url;){var e=this.graph.get("info").hasOwnProperty("title")&&""!==this.graph.get("info").title?this.graph.get("info").title:"app-"+(new Date).getTime();if(!this.setKey(e))return!1}var t,i=JSON.parse(JSON.stringify(this.graph)),n=i.info.url;if(this._loadedLocalApp)if(this._localApps.getByUrl(n)&&this._localApps.getByUrl(n)!==this._loadedLocalApp){if(!window.confirm('"'+n+'" already exists as a local app. Do you want to replace it?'))return!1;t=this._localApps.updateOrCreate(i)}else(t=this._loadedLocalApp).save({graph:i}),t.trigger("change");else{if(this._localApps.getByUrl(n)&&!window.confirm('"'+n+'" already exists as a local app. Do you want to replace it?'))return!1;t=this._localApps.updateOrCreate(i)}return this._loadedLocalApp=t,this.analyze("save","local","x"),this.updateCurrentInfo(),Iframework.router.navigate("local/"+n),t},forkLocal:function(){this._loadedLocalApp=null;var e=this.graph.get("info").url+"-copy";this.setKey(e),this.saveLocal()},deleteLocal:function(){this._loadedLocalApp&&(this._loadedLocalApp.destroy(),this._loadedLocalApp=null)},setTitle:function(){var e=this.$(".currentapp .info .settitle").text();e!==this.graph.get("info").title&&this.graph.setInfo("title",e)},setDescription:function(){var e=this.$(".currentapp .info .setdescription").text();e!==this.graph.get("info").description&&this.graph.setInfo("description",e)},setUrl:function(){var e=this.$(".currentapp .info .seturl").text();(e=this.encodeKey(e))!==this.graph.get("info").url&&this.graph.setInfo("url",e)},updateCurrentInfo:function(){var e,t,i,n,r,o=this.graph.toJSON();this.$(".currentapp").html(this.currentTemplate(o)),this.$(".currentapp .seturl").text(decodeURIComponent(o.info.url)),this.$(".currentapp .settitle").text(o.info.title),this.$(".currentapp .setdescription").text(o.info.description),this.$(".editable").attr("contenteditable","true"),!o.info.hasOwnProperty("parents")||0<(r=o.info.parents).length&&(0<(i=(n=r[r.length-1]).split("/")).length&&(e="https://app.meemoo.org/#gist/"+i[i.length-1],t=encodeURIComponent(e),r=encodeURIComponent(o.info.title),i=$("<span />").text(e).click(function(e){var t,i;document.body.createTextRange?((i=document.body.createTextRange()).moveToElementText(e.target),i.select()):window.getSelection&&(t=window.getSelection(),(i=document.createRange()).selectNodeContents(e.target),t.removeAllRanges(),t.addRange(i))}),n=$('<a title="your saved gist" target="_blank" class="share icon-github"></a>').attr("href",n),r=$('<a title="share on facebook" target="_blank" class="share icon-facebook-rect"></a>').attr("href","https://www.facebook.com/sharer.php?u="+t+"&t="+r),o=e+(o=120<=(o=" "+o.info.title+" #meemoo "+o.info.description).length?o.substr(0,115)+"...":o),o=$('<a title="post to twitter" target="_blank" class="share icon-twitter-bird"></a>').attr("href","https://twitter.com/intent/tweet?text="+encodeURIComponent(o)),this.$(".currentapp .permalink").empty().append(i).append(" ").append(n).append(r).append(o))),this._loadedLocalApp?this.$(".currentapp .deletelocal").show():this.$(".currentapp .deletelocal").hide()},newBlank:function(){this.loadGraph({info:{author:"meemoo",title:"Untitled",description:"Meemoo app description",parents:[],url:""},nodes:[],edges:[]}),this._loadedLocalApp=null,this.showPanel("library"),Iframework.router.navigate("new")},analyze:function(e,t,i){}});window.Iframework=new e,window.addEventListener("message",Iframework.gotMessage,!1)}),$(function(){Iframework.util={types:{undefined:"undefined",number:"number",boolean:"boolean",string:"string","[object Function]":"function","[object RegExp]":"regexp","[object Array]":"array","[object Date]":"date","[object Error]":"error","[object HTMLCanvasElement]":"HTMLCanvasElement","[object ImageData]":"ImageData"},type:function(e){return this.types[typeof e]||this.types[Object.prototype.toString.call(e)]||(e?"object":"null")},imageTypes:["png","gif","jpg","jpeg","webp"],isImageURL:function(e){e=e.split(".");if(1<e.length){e=e[e.length-1];return-1<this.imageTypes.indexOf(e)}return!1},imageDrop:function(e,t){if(!t)return!1;e.stopPropagation();var i=e.data.self,n=t.helper.data("meemoo-drag-type");if(!n||"canvas"!==n)return!1;var r,o=e.data.inputName;if(!o)return!1;e=t.helper.data("meemoo-image-url");if(e){var s=new Image;s.crossOrigin="anonymous",s.onload=function(){var e=(r=document.createElement("canvas")).getContext("2d");r.width=s.width,r.height=s.height,e.drawImage(s,0,0),i.receive(o,r)},s.src=e}else{if(!(r=t.helper.data("meemoo-drag-canvas")))return!1;i.receive(o,r)}},fitAndCopy:function(e,t){var i,n,r,o=t.width,s=t.height,a=o/s,l=e.width,h=e.height,l=l/h<=a?(n=l,r=Math.floor(l/a),i=0,Math.floor((h-r)/2)):(n=Math.floor(h*a),r=h,i=Math.floor((l-n)/2),0);t.getContext("2d").drawImage(e,i,l,n,r,0,0,o,s)}}}),$(function(){Iframework.Event=Backbone.Model.extend({defaults:function(){return{action:"",args:{}}},initialize:function(){}}),Iframework.EventsHistory=Backbone.Collection.extend({model:Iframework.Event}),Mousetrap.bind(["command+z","ctrl+z"],function(e){var t=window.Iframework.shownGraph,i=t.eventsHistory.last();if("removeNode"===i.get("action")){var n=i.get("args").node,r=t.usedIds.indexOf(n.get("id"));for(t.usedIds.splice(r,1),t.addNode(n),s=0;s<n.Inputs.length;s++)n.view.addInput(n.Inputs.at(s));for(s=0;s<n.Outputs.length;s++)n.view.addOutput(n.Outputs.at(s));for(var o=i.get("args").edges,s=0;s<o.length;s++)t.addEdge(o[s])}t.eventsHistory.pop()})}),$(function(){Iframework.LocalApp=Backbone.Model.extend({initializeView:function(){return this.view||(this.view=new Iframework.LocalAppView({model:this})),this.view},load:function(){Iframework._loadedLocalApp=this;var e=JSON.parse(JSON.stringify(this.get("graph")));Iframework.loadGraph(e)},toJSON:function(){return{id:this.id,graph:this.get("graph")}}}),Iframework.LocalApps=Backbone.Collection.extend({model:Iframework.LocalApp,localStorage:new Backbone.LocalStorage("LocalApps"),getByUrl:function(t){return this.find(function(e){return e.get("graph").info.url===t})},updateOrCreate:function(t){var e=this.find(function(e){return e.get("graph").info.url===t.info.url});return e?(e.save({graph:t}),e.trigger("change")):(e=this.create({graph:t})).initializeView(),e}})}),$(function(){Iframework.LocalAppView=Backbone.View.extend({tagName:"div",className:"localapp",template:_.template('<a class="url" href="#local/<%= graph.info.url %>"></a> - <a class="macro" title="load as subgraph into current graph" href="#">sub</a> '),events:{"click .macro":"loadAsMacro"},initialize:function(){return this.render(),Iframework.$(".localapps").append(this.el),this.model.on("change",this.update,this),this.model.on("destroy",this.remove,this),this},render:function(){this.$el.html(this.template(this.model.toJSON())),this.$(".url").text(decodeURIComponent(this.model.get("graph").info.url))},update:function(){this.render(),Iframework.updateCurrentInfo()},loadAsMacro:function(e){return e.preventDefault(),Iframework.shownGraph.addNode({src:"meemoo:subgraph/subgraph",state:{label:decodeURIComponent(this.model.get("graph").info.url),graph:this.model.get("graph")}}),!1},remove:function(){this.$el.remove()}})}),$(function(){Iframework.Graph=Backbone.Model.extend({loaded:!1,defaults:{info:{author:"meemoo",title:"Untitled",description:"Meemoo app description",parents:[],url:""},nodes:[],edges:[]},usedIds:[],edgeCount:0,eventsHistory:[],isSubgraph:!1,initialize:function(){var e=this.get("parentGraph");if(e&&(this.isSubgraph=!0,this.parentGraph=e),this.usedIds=[],this.attributes.nodes){var t=this.attributes.nodes;this.attributes.nodes=new Iframework.Nodes;for(var i=0;i<t.length;i++){var n=this.makeNode(t[i]);n&&this.addNode(n)}}if(this.attributes.edges){var r=this.attributes.edges;this.attributes.edges=new Iframework.Edges;for(var o=0;o<r.length;o++){r[o].parentGraph=this;var s=new Iframework.Edge(r[o]);this.addEdge(s)}}this.eventsHistory=new Iframework.EventsHistory;var a=this;_.defer(function(){a.testLoaded()}),this.on("change",this.graphChanged)},testLoaded:function(){var t=!0;return this.get("nodes").each(function(e){e.hasOwnProperty("lazyLoadType")&&(Iframework.NativeNodes.hasOwnProperty(e.lazyLoadType)?e.view&&!e.Native&&e.view.initializeNative():t=!1)},this),t&&this.initializeView(),t},initializeView:function(){this.view||(this.view=new Iframework.GraphView({model:this}))},setInfo:function(e,t){this.get("info")[e]=t,this.trigger("change")},makeNode:function(e){if(!e.src)return!1;e.parentGraph=this,Iframework.util.isImageURL(e.src)&&(n=e.src,e.src="meemoo:image/in",e.state||(e.state={}),e.state.url=n);var t,i,n=e.src.split(":");return!(n.length<2)&&("meemoo"===n[0]?(n=(t=(n=n[n.length-1]).split("/")).join("-"),i=this,t[0]&&t[1]&&yepnope([{test:Iframework.NativeNodes.hasOwnProperty(t[0]),nope:"src/nodes/"+t[0]+".js"},{test:Iframework.NativeNodes.hasOwnProperty(t[0]+"-"+t[1]),nope:"src/nodes/"+t[0]+"-"+t[1]+".js",complete:function(){_.defer(function(){i.testLoaded()})}}]),(t=new Iframework.NodeBox(e)).lazyLoadType=n):t=new Iframework.NodeBoxIframe(e),t)},addNode:function(e){if(!e.cid&&!(e=this.makeNode(e)))return!1;var t=this.get("nodes").length,i=parseInt(e.get("id"),10);for(i!=i&&e.set({id:t});0<=this.usedIds.indexOf(e.get("id"));)e.set({id:++t});this.usedIds.push(e.get("id"));for(var n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",r="",o=0;o<5;o++)r+=n.charAt(Math.floor(Math.random()*n.length));return e.frameIndex="frame_"+e.get("id")+"_"+Iframework.frameCount+++r+"_through",this.get("nodes").add(e),this.view&&this.view.addNode(e),this.trigger("change"),e},addEdge:function(t){return this.get("edges").any(function(e){return e.get("source")[0]===t.get("source")[0]&&e.get("source")[1]===t.get("source")[1]&&e.get("target")[0]===t.get("target")[0]&&e.get("target")[1]===t.get("target")[1]})?(console.warn("duplicate edge ignored",t),!1):(this.trigger("change"),this.get("edges").add(t))},remove:function(){this.get("nodes").each(function(e){e.remove(!1)}),this.view&&this.view.remove()},removeNode:function(t){var i=[];this.get("edges").each(function(e){e.Source&&e.Target&&(e.Source.parentNode!==t&&e.Target.parentNode!==t||i.push(e))},this),_.each(i,function(e){e.remove()}),this.view&&this.view.removeNode(t),this.get("nodes").remove(t),this.eventsHistory.add(new Iframework.Event({action:"removeNode",args:{node:t,edges:i}})),this.trigger("change")},removeEdge:function(e){e.disconnect(),this.get("edges").remove(e),this.view&&this.view.removeEdge(e),this.trigger("change")},checkLoaded:function(){for(var e=0;e<this.get("nodes").length;e++)if(!1===this.get("nodes").at(e).loaded)return!1;this.loaded=!0;var t=this;return setTimeout(function(){t.connectEdges()},500),!0},reconnectEdges:function(){for(var e=0;e<this.get("edges").length;e++)this.get("edges").at(e).disconnect();var t=this;_.delay(function(){t.connectEdges()},500)},connectEdges:function(){this.get("edges").each(function(e){e.connected||e.connect()}),this.get("nodes").each(function(e){e.setState()})},graphChanged:function(){Iframework.trigger("change",this)},toJSON:function(){return{info:this.get("info"),nodes:this.get("nodes"),edges:this.get("edges")}}}),Iframework.Graphs=Backbone.Collection.extend({model:Iframework.Graph})}),$(function(){Iframework.GraphView=Backbone.View.extend({tagName:"div",className:"graph",template:_.template('<div class="edges"><svg class="edgesSvg" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="300" height="300"></svg></div><div class="nodes" /><div class="iframework-graph-nav" style="display:none;"><button class="show-parent-graph">back to parent graph</button></div>'),events:{click:"click",dragenter:"ignoreDrag",dragover:"ignoreDrag",drop:"drop",selectablestart:"selectableStart",selectablestop:"selectableStop","click .show-parent-graph":"showParentGraph"},unhidden:!1,initialize:function(){this.render(),this.model.isSubgraph&&(this.$(".iframework-graph-nav").show(),this.$el.hide()),Iframework.$el.prepend(this.el),this.edgesSvg=this.$(".edgesSvg")[0],Iframework.$(".panel").is(":visible")&&this.$el.css("right","350px"),this.model.get("nodes").each(this.addNode.bind(this)),this.$el.droppable({accept:".addnode, .canvas, .meemoo-plugin-images-thumbnail"}),"ontouchstart"in document||this.$el.selectable({filter:".module",delay:20}),this.resizeEdgeSVG()},render:function(){return this.$el.html(this.template(this.model.toJSON())),this},renderAnimationFrame:function(t){this.model.get("nodes").each(function(e){e.view.Native&&e.view.Native.renderAnimationFrame(t)})},click:function(e){$(".edge-edit").remove(),Iframework.selectedPort=null,this.$(".module").removeClass("active"),this.$(".module").removeClass("ui-selected")},ignoreDrag:function(e){e.originalEvent.stopPropagation(),e.originalEvent.preventDefault()},drop:function(e,t){this.ignoreDrag(e);var i,n=e.originalEvent.dataTransfer;if(n&&(n.files,0<n.files.length&&(n=(r=n.files[0]).type.split("/"),i={x:this.el.scrollLeft+e.originalEvent.clientX+10,y:this.el.scrollTop+e.originalEvent.clientY+35},"image"===n[0]?(i.src="meemoo:image/in",i.state={url:window.URL.createObjectURL(r)},Iframework.shownGraph.addNode(i)):"video"===n[0]?(i.src="meemoo:video/player",i.state={url:window.URL.createObjectURL(r)},Iframework.shownGraph.addNode(i)):"text"===n[0]&&((n=new FileReader).onload=function(e){i.src="meemoo:ui/textarea",i.state={value:e.target.result},Iframework.shownGraph.addNode(i)},n.readAsText(r)))),!t)return!1;var r=t.helper.data("meemoo-drag-type");if(!r)return!1;var o={x:Math.round(this.el.scrollLeft+t.offset.left+10),y:Math.round(this.el.scrollTop+t.offset.top+35)};switch(r){case"library-module":var s=t.draggable.data("module");s&&s.view.dragAddNode(o);break;case"canvas":s=t.helper.data("meemoo-drag-canvas");s&&(o.src="meemoo:image/in",o.canvas=s,(s=t.helper.data("meemoo-image-url"))&&"http"===s.slice(0,4)&&(o.state={},o.state.url=s),Iframework.shownGraph.addNode(o))}return!1},addNode:function(e){this.$(".nodes").append(e.initializeView().el),e.lazyLoadType&&e.view.initializeNative()},addEdge:function(e){e.initializeView(),e.Source.view&&e.Source.view.resetRelatedEdges(),e.Target.view&&e.Target.view.resetRelatedEdges()},remove:function(){this.$el.remove()},removeNode:function(e){e.view&&e.view.remove()},removeEdge:function(e){e.Source&&e.Source.view&&e.Source.view.resetRelatedEdges(),e.Target&&e.Target.view&&e.Target.view.resetRelatedEdges(),e.view&&e.view.remove()},resizeEdgeSVG:_.debounce(function(){var e=this.$(".edgesSvg")[0];try{i=e.getBBox()}catch(e){return}var t=i.x+i.width+100,i=i.y+i.height+100;100===t&&100===i&&(t=this.$el.width(),i=this.$el.height()),e.getAttribute("width")<t&&e.setAttribute("width",Math.round(t)),e.getAttribute("height")<i&&e.setAttribute("height",Math.round(i))},100),selectableStart:function(){this.maskFrames()},selectableStop:function(e){this.unmaskFrames()},selectAll:function(){this.$(".module").addClass("ui-selected")},selectNone:function(){this.$(".module").removeClass("ui-selected")},cut:function(){for(this.copy(),t=0;t<Iframework._copied.nodes.length;t++)Iframework._copied.nodes[t].x-=50,Iframework._copied.nodes[t].y-=50;for(var e=this.$(".module.ui-selected"),t=0;t<e.length;t++)$(e[t]).data("iframework-node-view").removeModel()},copy:function(){for(var n,r={nodes:[],edges:[]},o=this.$(".module.ui-selected"),s=0;s<o.length;s++)n=$(o[s]).data("iframework-node-view").model,r.nodes.push(JSON.parse(JSON.stringify(n)));this.model.get("edges").each(function(e){var t,i=!1;for(s=0;s<o.length;s++)n=$(o[s]).data("iframework-node-view").model,e.Source.node===n&&(t=!0),e.Target.node===n&&(i=!0);t&&i&&r.edges.push(JSON.parse(JSON.stringify(e)))},this),Iframework._copied=r},paste:function(){var e=Iframework._copied;if(e&&0<e.nodes.length){var t=[];this.$(".module").removeClass("ui-selected");for(var i=0;i<e.nodes.length;i++){var n=JSON.parse(JSON.stringify(e.nodes[i]));n.x+=50,n.y+=50,n.parentGraph=this.model;var r=this.model.addNode(n);r.copiedFrom=n.id,t.push(r),r.view&&r.view.select()}for(var o=0;o<e.edges.length;o++){for(var s=JSON.parse(JSON.stringify(e.edges[o])),a={source:[],target:[]},l=0;l<t.length;l++){var h=t[l];s.source[0]===h.copiedFrom&&(a.source[0]=h.id),s.target[0]===h.copiedFrom&&(a.target[0]=h.id)}a.source[1]=s.source[1],a.target[1]=s.target[1],a.parentGraph=this.model,a=new Iframework.Edge(a),this.model.addEdge(a)}}},maskFrames:function(){$(".iframe-type").append('<div class="iframemask" />')},unmaskFrames:function(){$(".iframemask").remove()},showParentGraph:function(){this.model.parentGraph&&Iframework.showGraph(this.model.parentGraph)},rerenderEdges:function(){this.model.get("edges").each(function(e){e.view&&e.view.redraw()},this)}})}),$(function(){Iframework.Node=Backbone.Model.extend({send:function(e){},receive:function(e){},sendFromFrame:function(){},iframeLoaded:function(){}}),Iframework.Nodes=Backbone.Collection.extend({model:Iframework.Node})}),$(function(){Iframework.NodeView=Backbone.View.extend({send:function(e){this.model.send(e)},receive:function(e){this.model.receive(e)}})}),$(function(){Iframework.NodeBox=Iframework.Node.extend({loaded:!1,defaults:function(){return{src:"",x:100,y:400,z:0,w:200,h:210,state:{}}},info:{title:"native-node",description:"extend me"},initialize:function(){this.Inputs=new Iframework.PortsIn,this.Outputs=new Iframework.PortsOut,this.parentGraph=this.get("parentGraph"),this.on("change",this.nodeChanged)},initializeView:function(){return this.view=new Iframework.NodeBoxView({model:this}),this.view},send:function(e,t){var i=this;_.defer(function(){i.trigger("send:"+e,t)})},receive:function(e,t){this.view.Native&&this.view.Native.receive(e,t)},infoLoaded:function(e){this.info=e,this.view&&this.view.infoLoaded(e)},setState:function(){var e=this.get("state");if(e&&this.view.Native)for(var t in e)this.setEquation(t,e[t])||this.receive(t,e[t])},addInput:function(e){void 0===e.id&&(e.id=e.name);var t=(e.parentNode=this).Inputs.get(e.id);if(!t){var i=new Iframework.PortIn(e);i.isIn=!0,i.node=this,i.parentGraph=this.parentGraph,this.Inputs.add(i),this.view&&this.view.addInput(i);var n=this.get("state");return e.hasOwnProperty("default")&&""!==e.default&&!n.hasOwnProperty(e.name)&&(n[e.name]=e.default),i}t.set(e)},addOutput:function(e){void 0===e.id&&(e.id=e.name);var t=(e.parentNode=this).Outputs.get(e.id);if(!t){var i=new Iframework.PortOut(e);return i.isIn=!1,i.node=this,i.parentGraph=this.parentGraph,this.Outputs.add(i),this.view&&this.view.addOutput(i),i}t.set(e)},nodeChanged:function(){this.parentGraph&&this.parentGraph.trigger("change")},remove:function(e){e?this.parentGraph.removeNode(this):this.view&&this.view.remove()},setValues:function(e){for(var t in e)this.setValue(t,e[t]);this.nodeChanged()},setValue:function(e,t){this.setEquation(e,t),this.get("state")[e]=t,this.nodeChanged()},setEquation:function(e,t){if(this.view.Native){var i=this.Inputs.get(e);if(i){i=i.get("type");if("int"===i||"float"===i||"number"===i){if(t&&"="===t.toString().substr(0,1))return this.view.Native.setEquation(e,t.substr(1)),!0;this.view.Native.setEquation(e)}}}},toString:function(){return this.info?"Native node "+this.get("id")+": "+this.info.title:"Native node "+this.get("id")},toJSON:function(){return{id:this.id,src:this.get("src"),x:this.get("x"),y:this.get("y"),w:this.get("w"),h:this.get("h"),state:this.get("state")}}}),Iframework.Nodes=Backbone.Collection.extend({model:Iframework.Node})}),$(function(){Iframework.NodeBoxView=Iframework.NodeView.extend({tagName:"div",className:"node",template:_.template('<div class="module" style="left:<%= get("x")-10 %>px;top:<%= get("y")-30 %>px;width:<%= get("w")+20 %>px;height:<%= get("h")+40 %>px;" ><div class="outer"></div><div class="ports ports-in"></div><div class="ports ports-out"></div><h1 class="title"><span class="module-icon module-icon-small"></span><span class="node-box-title-name">...</span></h1><button title="show controls" type="button" class="showcontrols icon-left-open"></button><div class="controls"><button title="remove module" type="button" class="remove icon-trash"></button><a title="view source" type="button" class="viewsource button icon-cog"></a><button title="hide controls" type="button" class="hidecontrols icon-right-open"></button></div><div class="inner"></div></div>'),events:{"dragstart .module":"dragStart","drag .module":"drag","dragstop .module":"dragStop","resizestart .module":"resizestart","resize .module":"resize","resizestop .module":"resizestop","mousedown .module, .title":"mousedown","click .module, .title":"click","click .showcontrols":"showControls","click .hidecontrols":"hideControls","click .remove":"removeModel"},initialize:function(){this.render(),this.$(".module").data({"iframework-node-view":this}).draggable({handle:"h1",helper:function(e){var t=$(this);return $('<div class="ui-draggable-helper" style="width:'+t.width()+"px; height:"+t.height()+'px">')}}).resizable({minHeight:100,minWidth:100,helper:"ui-draggable-helper"}),this.model.lazyLoadType?this.$(".viewsource").attr({href:"src/nodes/"+this.model.lazyLoadType+".js",target:"_blank"}):this.$(".viewsource").hide(),this.$("h1").disableSelection(),this.mousedown()},initializeNative:function(){this.Native||Iframework.NativeNodes.hasOwnProperty(this.model.lazyLoadType)&&(this.Native=new Iframework.NativeNodes[this.model.lazyLoadType]({model:this.model}),this.$(".inner").append(this.Native.$el),this.model.loaded=!0,this.model.parentGraph.checkLoaded())},render:function(){return this.$el.html(this.template(this.model)),this},infoLoaded:function(e){this.$("h1").attr("title",this.model.get("id")+": "+(e.author?"by "+e.author+": ":"")+e.description),this.$(".node-box-title-name").text(e.title),this.model.lazyLoadType&&this.$(".module-icon").addClass("module-icon-"+this.model.lazyLoadType)},_alsoDrag:[],_dragDelta:{},dragStart:function(e,t){var i;e.target===this.$(".module")[0]&&(this.model.parentGraph.view.maskFrames(),this.$(".module").hasClass("ui-selected")||this.click(e),(i=this)._alsoDrag=[],this.model.parentGraph.view.$(".ui-selected").each(function(){var e,t;i.$(".module")[0]!==this&&(e=$(this),t={left:parseInt(e.css("left"),10),top:parseInt(e.css("top"),10)},e.data("ui-draggable-alsodrag-initial",t),t=$('<div class="ui-draggable-helper">').css({width:e.width(),height:e.height(),left:t.left,top:t.top}),e.parent().append(t),e.data("ui-draggable-alsodrag-helper",t),i._alsoDrag.push(e))}))},drag:function(e,t){var i,n,r;e.target===this.$(".module")[0]&&this._alsoDrag.length&&(e=(i=$(e.target).data("ui-draggable")).originalPosition,n=i.position.top-e.top||0,r=i.position.left-e.left||0,_.each(this._alsoDrag,function(e){var t=e.data("ui-draggable-alsodrag-initial");e.data("ui-draggable-alsodrag-helper").css({left:t.left+r,top:t.top+n})}))},dragStop:function(e,t){e.target===this.$(".module")[0]&&(e=parseInt(t.position.left,10),t=parseInt(t.position.top,10),this.moveToPosition(e,t),this._alsoDrag.length&&(_.each(this._alsoDrag,function(e){e.data("ui-draggable-alsodrag-initial");var t=e.data("ui-draggable-alsodrag-helper");e.data("iframework-node-view").moveToPosition(parseInt(t.css("left"),10),parseInt(t.css("top"),10)),t.remove(),e.data("ui-draggable-alsodrag-initial",null),e.data("ui-draggable-alsodrag-helper",null)}),this._alsoDrag=[]),this.model.parentGraph.view.unmaskFrames())},moveToPosition:function(e,t){this.$(".module").css({left:e,top:t}),this.model.set({x:e+10,y:t+30})},resizestart:function(e,t){this.model.parentGraph.view.maskFrames()},resize:function(e,t){},resizestop:function(e,t){this.model.parentGraph.view.unmaskFrames();var i=t.size.width,t=t.size.height;this.model.set({w:i-20,h:t-40}),this.Native&&this.Native.resize(i,t),this.model.parentGraph.view.resizeEdgeSVG()},mousedown:function(e,t){var i=0;$("div.module").each(function(){var e=Number($(this).css("z-index"));i<e&&(i=e)}),this.$(".module").css("z-index",i+1),e&&e.stopPropagation()},click:function(e){e.ctrlKey||e.metaKey?this.$(".module").toggleClass("ui-selected"):(this.model.parentGraph.view.$(".ui-selected").removeClass("ui-selected"),this.$(".module").addClass("ui-selected")),e.stopPropagation()},select:function(e){this.$(".module").addClass("ui-selected")},addInput:function(e){this.$(".ports-in").append(e.initializeView().el)},addOutput:function(e){this.$(".ports-out").append(e.initializeView().el)},showControls:function(){this.$(".showcontrols").hide(),this.$(".controls").show()},hideControls:function(){this.$(".showcontrols").show(),this.$(".controls").hide()},removeModel:function(){this.model.remove(!0)},remove:function(){this.Native&&this.Native.remove(),this.$el.remove()},refresh:function(){},popout:function(){}})}),$(function(){Iframework.NodeBoxNativeView=Backbone.View.extend({tagName:"div",className:"nativenode",template:_.template('<div class="info" />'),info:{title:"native-node-view",description:"extend me"},inputs:{},outputs:{},initialize:function(){for(var e in this.render(),this.model.infoLoaded(this.info),this.inputs){var t;this.inputs.hasOwnProperty(e)&&((t=this.inputs[e]).name=e,this.model.addInput(t))}for(var i in this.outputs){var n;this.outputs.hasOwnProperty(i)&&((n=this.outputs[i]).name=i,this.model.addOutput(n))}return this.initializeCategory(),this.initializeModule(),this},initializeCategory:function(){},initializeModule:function(){},render:function(){return this.$el.html(this.template(this.model)),this},redraw:function(e){},_triggerRedraw:!1,_lastRedraw:0,renderAnimationFrame:function(e){this._triggerRedraw&&(this._triggerRedraw=!1,this.redraw(e),this._lastRedraw=e)},set:function(e,t){this.model.setValue(e,t)},send:function(e,t){this.model.send(e,t)},setEquation:function(t,e){if(this.equations||(this.equations={}),e)try{var i=Parser.parse(e);this.equations[t]=i,-1===e.indexOf("x")&&this.receive(t,0)}catch(e){this.equations[t]=function(e){return e.x}}else this.equations[t]&&(this.equations[t]=void 0)},receive:function(e,t){this.equations&&this.equations[e]&&(t=this.equations[e].evaluate({x:t})),this["input"+e]?this["input"+e](t):(this["_"+e]=t,this._triggerRedraw=!0)},toString:function(){return"Native view: "+this.model.get("id")+": "+this.info.title},resize:function(e,t){},connectEdge:function(e){},disconnectEdge:function(e){},remove:function(){}})}),$(function(){Iframework.NodeBoxIframe=Iframework.NodeBox.extend({initializeView:function(){return this.view=new Iframework.NodeBoxIframeView({model:this}),this.view},info:{title:"iframe-node",description:"extend me"},sendFromFrame:function(e){var t=e.output,i=e.value;"ImageData"===Iframework.util.type(e.value)&&(i=this.makeCanvas(i)),this.send(t,i)},receive:function(e,t){if(this.view&&this.view.iframeloaded){if("HTMLCanvasElement"===Iframework.util.type(t))try{t=t.getContext("2d").getImageData(0,0,t.width,t.height)}catch(e){return!1}var i={};i[e]=t,this.view.iframe.contentWindow.postMessage(i,"*")}else console.error("wat "+this.id+" "+this.frameIndex)},setState:function(){var e=this.get("state");e&&this.receive({setState:e})},iframeLoaded:function(){this.loaded=!0,this.parentGraph.checkLoaded()},toString:function(){return this.info?"Iframe node "+this.get("id")+": "+this.info.title:"Iframe node "+this.get("id")},makeCanvas:function(e){return this.canvas||(this.canvas=document.createElement("canvas"),this.context=this.canvas.getContext("2d")),this.canvas.width===e.width&&this.canvas.height===e.height||(this.canvas.width=e.width,this.canvas.height=e.height),this.context.putImageData(e,0,0),this.canvas}}),Iframework.Nodes=Backbone.Collection.extend({model:Iframework.Node})}),$(function(){Iframework.NodeBoxIframeView=Iframework.NodeBoxView.extend({initialize:function(){Iframework.NodeBoxView.prototype.initialize.call(this),this.$("button.remove").after($('<button title="reload iframe" type="button" class="refresh icon-cw"></button>')),this.events["click .refresh"]="refresh",this.$(".inner").addClass("iframe-type");var e=this;this.iframe.onload=function(){e.iframeloaded=!0}},render:function(){return this.$el.html(this.template(this.model)),this.iframe=document.createElement("iframe"),$(this.iframe).attr({class:"iframe",name:this.model.frameIndex,src:this.model.get("src")}),this.$(".inner").html(this.iframe),this},refresh:function(){this.$("iframe")[0].src=this.model.get("src")}})}),$(function(){Iframework.Port=Backbone.Model.extend({defaults:{name:"",type:"",description:"",default:null},initialize:function(){""===this.get("type")&&this.set("type","all"),this.parentNode=this.get("parentNode"),this.set("type_class",this.get("type").split(":")[0]),this.Edges=new Iframework.Edges},connect:function(e){this.Edges.add(e)},disconnect:function(e){this.Edges.remove(e)},remove:function(){for(;0<this.Edges.length;){var e=this.Edges.at(0);this.parentNode.parentGraph.removeEdge(e)}this.view&&this.view.remove()}}),Iframework.Ports=Backbone.Collection.extend({model:Iframework.Port})}),$(function(){Iframework.PortView=Backbone.View.extend({tagName:"div",className:"port",popupTemplate:_.template('<div class="edge-edit"><button title="close" class="close icon-cancel"></button><h2><%= name %> (<%= type %>)</h2><p><%= description %></p></div>'),edgeEditTemplate:_.template('<div class="edge-edit-item" id="<%= model.cid %>"><span><%= label() %></span><button title="disconnect" class="disconnect icon-scissors" type="button"></button></div>'),events:{mousedown:"highlightEdge","click .hole":"clickhole","dragstart .hole":"dragstart","drag .hole, .holehelper":"drag","dragstop .hole, .holehelper":"dragstop","dragstart .plugend":"unplugstart","drag .plugend":"unplugdrag","dragstop .plugend":"unplugstop",drop:"drop","click .disconnect":"disconnect","submit .manualinput":"manualinput"},initialize:function(){return this.render(),this},dragstart:function(e,t){this.model.node.parentGraph.view.maskFrames(),$("div.ports-"+(this.model.isIn?"out":"in")+" span.hole").addClass("fade"),$("div.ports-"+(this.model.isIn?"out":"in")+" span.hole-"+this.model.get("type_class")).addClass("highlight");var i=new Iframework.EdgeView;Iframework.edgePreview=i,this.drag(e,t),this.$(".plugend").show(),e.stopPropagation()},drag:function(e,t){var i,n,r;Iframework.edgePreview&&(i=t.offset.left+Iframework.shownGraph.view.el.scrollLeft,r=t.offset.top+8+Iframework.shownGraph.view.el.scrollTop,n=this.portOffsetLeft(),t=this.portOffsetTop(),r={fromX:this.model.isIn?i-2:n,fromY:this.model.isIn?r:t,toX:this.model.isIn?n:i+20,toY:this.model.isIn?t:r},Iframework.edgePreview.setPositions(r),Iframework.edgePreview.redraw()),e.stopPropagation()},dragstop:function(e,t){this.model.node.parentGraph.view.unmaskFrames(),$(".hole").removeClass("fade highlight"),Iframework.edgePreview.remove(),Iframework.edgePreview=void 0,this.relatedEdges().length<1&&this.$(".plugend").hide(),e.stopPropagation()},drop:function(e,t){var i,n;this.armDelete?this.armDelete=!1:(n=$(t.draggable).data("model"),i=this.model,t=this.model.isIn?n:i,n=this.model.isIn?i:n,n=new Iframework.Edge({source:[t.node.get("id"),t.get("name")],target:[n.node.get("id"),n.get("name")],parentGraph:this.model.parentGraph}),Iframework.edgePreview&&(n._color=Iframework.edgePreview._color),n.parentGraph.addEdge(n)&&n.connect()),e.stopPropagation()},unpluggingEdge:null,armDeleteTimeout:null,armDelete:!1,topConnectedEdge:function(){var t,i=0;return _.each(this.relatedEdges(),function(e){e.view._z>=i&&(i=e.view._z,t=e)},this),t},unplugstart:function(e,t){this.model.node.parentGraph.view.maskFrames();var i=this.topConnectedEdge();if(!i)return!1;this.unpluggingEdge=i,this.unpluggingEdge.view.dim(),1===this.relatedEdges().length&&this.$(".plugend").hide();i=this.model.isIn?this.unpluggingEdge.Source:this.unpluggingEdge.Target;this.$(".plugend").data("model",i),$("div.ports-"+(this.model.isIn?"in":"out")+" span.hole-"+this.model.get("type_class")).addClass("highlight");i=new Iframework.EdgeView;i.setColor(this.unpluggingEdge.view._color),Iframework.edgePreview=i,this.armDelete=!0,e.stopPropagation()},unplugdrag:function(e,t){var i,n,r;Iframework.edgePreview&&this.unpluggingEdge&&(i=t.offset.left+Iframework.shownGraph.view.el.scrollLeft,n=t.offset.top+6+Iframework.shownGraph.view.el.scrollTop,t=(r=(this.model.isIn?this.unpluggingEdge.Source:this.unpluggingEdge.Target).view).portOffsetLeft(),r=r.portOffsetTop(),r={fromX:this.model.isIn?t:i-2,fromY:this.model.isIn?r:n,toX:this.model.isIn?i+20:t,toY:this.model.isIn?n:r},Iframework.edgePreview.setPositions(r),Iframework.edgePreview.redraw()),e.stopPropagation()},unplugstop:function(e,t){this.armDelete&&this.unpluggingEdge?this.model.parentGraph.removeEdge(this.unpluggingEdge):(this.$(".plugend").show(),this.unpluggingEdge.view.undim()),this.armDelete=!1,this.unpluggingEdge=null,this.dragstop(e,t)},clickhole:function(e){$("div.edge-edit").remove();var t=this.$(".hole"),i=this.model.isIn,n=(this.model.get("name"),this.popupTemplate(this.model.toJSON())),n=$(n);this.$el.append(n),n.children("button.close").button({icons:{primary:"icon-cancel"},text:!1}).click(function(){$("div.edge-edit").remove(),Iframework.selectedPort=null});var r,o=this.model.get("type").substring(0,3);i&&(r=!1,i=$("<form />").attr({id:this.model.node.id+"_"+this.model.get("name"),class:"manualinput"}),"int"===o||"num"===o||"flo"===o?(r=!0,i.append($("<input />").attr({type:"number",min:t.data("min"),max:t.data("max"),step:"any",value:this.model.node.get("state")[this.model.get("name")]}))):"col"===o||"str"===o?(r=!0,i.append($("<input />").attr({type:"text",maxlength:t.data("max"),value:this.model.node.get("state")[this.model.get("name")]}))):"boo"===o?(r=!0,t=this.model.node.get("state")[this.model.get("name")],t=Boolean(t)&&"false"!==t,i.append($("<input />").attr({type:"checkbox",checked:t}))):"ban"===o&&(i.append("<label>Send bang:</label> "),r=!0),r&&(i.append($("<button></button>").html("send").attr({type:"submit",class:"send",title:"send value to module"}).button({icons:{primary:"icon-ok"},text:!1})),n.append(i))),$("#select_"+this.model.id).button({icons:{primary:"ui-icon-power"}}),0<this.relatedEdges().length&&(n.append("<h2>disconnect</h2>"),_.each(this.relatedEdges(),function(e){e=this.edgeEditTemplate(e.view);n.append(e)},this)),this.model.get("options")&&0<this.model.get("options").length&&this.$("input").autocomplete({minLength:0,source:this.model.get("options")}),e.stopPropagation()},manualinput:function(e){var t,i=this.model.get("name");this.$(".manualinput").children("input")&&(t=this.$(".manualinput").children("input").val()),0<this.$(".manualinput").children("input:checkbox").length&&(t=!!this.$(".manualinput").children("input:checkbox").is(":checked")),"int"===this.model.get("type")&&(t=parseInt(t,10)),"number"!==this.model.get("type")&&"float"!==this.model.get("type")||(t=parseFloat(t));var n={};return n[i]=t=void 0===t?"!":t,this.model.node.receive(n),this.model.node.get("state")[i]=t,this.model.node.trigger("change"),!1},disconnect:function(e){var t=this.model.parentGraph.get("edges").getByCid($(e.target).parents(".edge-edit-item").attr("id"));t&&this.model.parentGraph.removeEdge(t),$("div.edge-edit").remove(),Iframework.selectedPort=null,e.stopPropagation()},portOffsetLeft:function(){var e=this.$(".hole").offset();return e?e.left+7+this.model.parentNode.parentGraph.view.el.scrollLeft:0},portOffsetTop:function(){var e=this.$(".hole").offset();return e?e.top+10+this.model.parentNode.parentGraph.view.el.scrollTop:0},_relatedEdges:null,relatedEdges:function(){return null===this._relatedEdges&&(this._relatedEdges=this.model.parentGraph.get("edges").filter(function(e){return e.Source===this.model||e.Target===this.model},this),1<=this._relatedEdges.length?this.$(".plugend").show():this.$(".plugend").hide(),this.model.node.view.resetRelatedEdges()),this._relatedEdges},resetRelatedEdges:function(){this._relatedEdges=null,this.relatedEdges()},highlightEdge:function(){var e;0<this.relatedEdges().length&&((e=this.topConnectedEdge())&&e.view&&e.view.highlight())},highlight:function(){var e=this.$(".plugend");e.addClass("highlight"),setTimeout(function(){e.removeClass("highlight")},1e3)},publishPort:function(){}})}),$(function(){Iframework.PortIn=Iframework.Port.extend({defaults:{name:"",type:"",description:"",default:null},initializeView:function(){return this.view=new Iframework.PortInView({model:this}),this.view}}),Iframework.PortsIn=Backbone.Collection.extend({model:Iframework.PortIn})}),$(function(){Iframework.PortInView=Iframework.PortView.extend({tagName:"div",className:"port",portInTemplate:_.template('<div class="portshown portshown-in"><span class="hole hole-in hole-<%= type_class %> icon-login"></span><span class="label"><%= name %></span></div><span class="plugend plugend-in plugend-<%= type_class %>"></span>'),events:{mousedown:"highlightEdge","click .hole":"clickhole","dragstart .hole":"dragstart","drag .hole, .holehelper":"drag","dragstop .hole, .holehelper":"dragstop","dragstart .plugend":"unplugstart","drag .plugend":"unplugdrag","dragstop .plugend":"unplugstop",drop:"drop","click .disconnect":"disconnect","submit .manualinput":"manualinput"},render:function(){this.$el.html(this.portInTemplate(this.model.toJSON())),this.$el.addClass("port-in"),this.$(".hole").draggable({helper:function(e){return $('<span class="holehelper holehelper-out" />')}}),this.$(".plugend").draggable({helper:function(e){return $('<span class="plugendhelper plugendhelper-in" />')}}),this.$(".hole").data({model:this.model});var e="",t=this.model.get("type_class"),e="all"===t||"bang"===t?".hole-out, .plugend-in":".hole-out.hole-all, .hole-out.hole-"+t+", .plugend-in.plugend-all, .plugend-in.plugend-"+t;"string"===t&&(e+=", .hole-out.hole-int, .hole-out.hole-float, .plugend-in.plugend-int, .plugend-in.plugend-float"),"int"!==t&&"float"!==t&&"number"!==t||(e+=", .hole-out.hole-int, .hole-out.hole-float, .hole-out.hole-number, .plugend-in.plugend-int, .plugend-in.plugend-float, .plugend-in.plugend-number"),this.$el.droppable({hoverClass:"drophover",accept:e}),this.$(".plugend").hide(),this.$(".portshown").disableSelection()},dragstart:function(e,t){this.model.node.parentGraph.view.maskFrames(),$("div.ports-"+(this.model.isIn?"out":"in")+" span.hole").addClass("fade"),$("div.ports-"+(this.model.isIn?"out":"in")+" span.hole-"+this.model.get("type_class")).addClass("highlight");var i=new Iframework.EdgeView;Iframework.edgePreview=i,this.drag(e,t),this.$(".plugend").show(),e.stopPropagation()},drag:function(e,t){var i,n,r;Iframework.edgePreview&&(i=t.offset.left+Iframework.shownGraph.view.el.scrollLeft,r=t.offset.top+8+Iframework.shownGraph.view.el.scrollTop,n=this.portOffsetLeft(),t=this.portOffsetTop(),r={fromX:this.model.isIn?i-2:n,fromY:this.model.isIn?r:t,toX:this.model.isIn?n:i+20,toY:this.model.isIn?t:r},Iframework.edgePreview.setPositions(r),Iframework.edgePreview.redraw()),e.stopPropagation()},dragstop:function(e,t){this.model.node.parentGraph.view.unmaskFrames(),$(".hole").removeClass("fade highlight"),Iframework.edgePreview.remove(),Iframework.edgePreview=void 0,this.relatedEdges().length<1&&this.$(".plugend").hide(),e.stopPropagation()},drop:function(e,t){var i,n;this.armDelete?this.armDelete=!1:(n=$(t.draggable).data("model"),i=this.model,t=this.model.isIn?n:i,n=this.model.isIn?i:n,n=new Iframework.Edge({source:[t.node.id,t.id],target:[n.node.id,n.id],parentGraph:this.model.parentNode.parentGraph}),Iframework.edgePreview&&(n._color=Iframework.edgePreview._color),n.parentGraph.addEdge(n)&&n.connect()),e.stopPropagation()},unpluggingEdge:null,armDeleteTimeout:null,armDelete:!1,topConnectedEdge:function(){var t,i=0;return _.each(this.relatedEdges(),function(e){e.view._z>=i&&(i=e.view._z,t=e)},this),t},unplugstart:function(e,t){this.model.node.parentGraph.view.maskFrames();var i=this.topConnectedEdge();if(!i)return!1;this.unpluggingEdge=i,this.unpluggingEdge.view.dim(),1===this.relatedEdges().length&&this.$(".plugend").hide();i=this.model.isIn?this.unpluggingEdge.Source:this.unpluggingEdge.Target;this.$(".plugend").data("model",i),$("div.ports-"+(this.model.isIn?"in":"out")+" span.hole-"+this.model.get("type_class")).addClass("highlight");i=new Iframework.EdgeView;i.setColor(this.unpluggingEdge.view._color),Iframework.edgePreview=i,this.armDelete=!0,e.stopPropagation()},unplugdrag:function(e,t){var i,n,r;Iframework.edgePreview&&this.unpluggingEdge&&(i=t.offset.left+Iframework.shownGraph.view.el.scrollLeft,n=t.offset.top+6+Iframework.shownGraph.view.el.scrollTop,t=(r=(this.model.isIn?this.unpluggingEdge.Source:this.unpluggingEdge.Target).view).portOffsetLeft(),r=r.portOffsetTop(),r={fromX:this.model.isIn?t:i-2,fromY:this.model.isIn?r:n,toX:this.model.isIn?i+20:t,toY:this.model.isIn?n:r},Iframework.edgePreview.setPositions(r),Iframework.edgePreview.redraw()),e.stopPropagation()},unplugstop:function(e,t){this.armDelete&&this.unpluggingEdge?this.model.parentGraph.removeEdge(this.unpluggingEdge):(this.$(".plugend").show(),this.unpluggingEdge.view.undim()),this.armDelete=!1,this.unpluggingEdge=null,this.dragstop(e,t)},clickhole:function(e){$("div.edge-edit").remove();var t=this.$(".hole"),i=(this.model.isIn,this.model.get("name")),n=this.popupTemplate(this.model.toJSON()),n=$(n);this.$el.append(n),n.children("button.close").click(function(){$("div.edge-edit").remove(),Iframework.selectedPort=null});var r=this.model.get("type").substring(0,3),o=!1,s=$("<form />").attr({id:this.model.node.id+"_"+this.model.get("name"),class:"manualinput",novalidate:""});if("int"===r||"num"===r||"flo"===r)o=!0,s.append($("<input />").attr({value:this.model.node.get("state")[this.model.get("name")],title:'use equations like "=x*100" to change all incoming values'}));else if("col"===r){var o=!0,a=this.model.node.get("state")[this.model.get("name")],l=$("<input />").attr({type:"text",maxlength:140,value:a,style:"width: 90%"});s.append(l);var h=this;l.spectrum({showInitial:!0,showInput:!0,showAlpha:!0,showPalette:!0,palette:[Iframework.wireColors,["red","green","blue","purple","cyan","magenta","yellow"],["black","#333","#666","#999","#AAA","#CCC","white"]],showSelectionPalette:!0,localStorageKey:"iframework.settings.colorPalette",change:function(e){e=e.toRgbString();l.val(e),h.model.node.receive(i,e),h.model.node.setValue(i,e)},hide:function(e){l.show()},beforeShow:function(){l.spectrum("set",l.val()),l.hide()}}).show()}else if("str"===r)o=!0,s.append($("<input />").attr({type:"text",maxlength:t.data("max"),value:this.model.node.get("state")[this.model.get("name")]}));else if("arr"===r){o=!0;var d=this.model.node.get("state")[this.model.get("name")];"array"!==Iframework.util.type(d)&&(d=[]);for(var u="",c=0;c<d.length;c++)u+=(0<c?", ":"")+d[c];s.append($("<input />").attr({type:"text",value:u}))}else"boo"===r?(o=!0,t=this.model.node.get("state")[this.model.get("name")],t=Boolean(t)&&"false"!==t,s.append($("<input />").attr({type:"checkbox",checked:t}))):"ban"===r&&(s.append("<label>Send bang:</label> "),o=!0);o&&(s.append($("<button></button>").attr({type:"submit",class:"send icon-ok",title:"send value to module"})),n.append(s)),$("#select_"+this.model.id).button({icons:{primary:"ui-icon-power"}}),0<this.relatedEdges().length&&(n.append("<h2>disconnect</h2>"),_.each(this.relatedEdges(),function(e){e=this.edgeEditTemplate(e.view);n.append(e)},this)),this.model.get("options")&&0<this.model.get("options").length&&this.$("input").autocomplete({minLength:0,source:this.model.get("options")}),e.stopPropagation()},manualinput:function(e){var t,i=this.model.get("name"),n=this.model.get("type"),r=n.substring(0,3),o=!0;if(this.$(".manualinput").children("input")&&(t=this.$(".manualinput").children("input").val()),0<this.$(".manualinput").children("input:checkbox").length&&(t=!!this.$(".manualinput").children("input:checkbox").is(":checked")),"int"!==n&&"number"!==n&&"float"!==n||"string"==typeof t&&"="===t.toString().substr(0,1)||("int"===n?t=parseInt(t,10):"number"!==n&&"float"!==n||(t=parseFloat(t))),"arr"===r)try{t=JSON.parse("["+t+"]")}catch(e){return!1}return(o=void 0===t?!(t="!"):o)&&this.model.node.setValue(i,t),this.model.node.receive(i,t),!1},disconnect:function(e){var t=this.model.parentGraph.get("edges").getByCid($(e.target).parents(".edge-edit-item").attr("id"));t&&this.model.parentGraph.removeEdge(t),$("div.edge-edit").remove(),Iframework.selectedPort=null,e.stopPropagation()},_relatedEdges:null,relatedEdges:function(){return null===this._relatedEdges&&(this._relatedEdges=this.model.parentGraph.get("edges").filter(function(e){return e.Source===this.model||e.Target===this.model},this),1<=this._relatedEdges.length?this.$(".plugend").show():this.$(".plugend").hide()),this._relatedEdges},resetRelatedEdges:function(){this._relatedEdges=null,this.relatedEdges()},highlightEdge:function(){var e;0<this.relatedEdges().length&&((e=this.topConnectedEdge())&&e.view&&e.view.highlight())},highlight:function(){var e=this.$(".plugend");e.addClass("highlight"),setTimeout(function(){e.removeClass("highlight")},1e3)},publishPort:function(){var e=this.model.parentNode.parentGraph.addNode({src:"meemoo:subgraph/input",x:100,y:100,w:80,h:60,state:{label:this.model.id},parentGraph:this.model.parentNode.parentGraph}),e=new Iframework.Edge({source:[e.id,"data"],target:[this.model.parentNode.id,this.model.id],parentGraph:this.model.parentNode.parentGraph});this.model.parentNode.parentGraph.addEdge(e)}})}),$(function(){Iframework.PortOut=Iframework.Port.extend({defaults:{name:"",type:"",description:"",default:null},initializeView:function(){return this.view=new Iframework.PortOutView({model:this}),this.view}}),Iframework.PortsOut=Backbone.Collection.extend({model:Iframework.PortOut})}),$(function(){Iframework.PortOutView=Iframework.PortView.extend({tagName:"div",className:"port",portOutTemplate:_.template('<div class="portshown portshown-out"><span class="label"><%= name %></span><span class="hole hole-out hole-<%= type_class %> icon-logout"></span></div><span class="plugend plugend-out plugend-<%= type_class %>"></span>'),events:{mousedown:"highlightEdge","click .hole":"clickhole","dragstart .hole":"dragstart","drag .hole, .holehelper":"drag","dragstop .hole, .holehelper":"dragstop","dragstart .plugend":"unplugstart","drag .plugend":"unplugdrag","dragstop .plugend":"unplugstop",drop:"drop","click .disconnect":"disconnect"},render:function(){this.$el.html(this.portOutTemplate(this.model.toJSON())),this.$el.addClass("port-out"),this.$(".hole").draggable({helper:function(e){return $('<span class="holehelper holehelper-in" />')}}),this.$(".plugend").draggable({helper:function(e){return $('<span class="plugendhelper plugendhelper-out" />')}}),this.$(".hole").data({model:this.model});var e="",t=this.model.get("type_class");"all"===t?e=".hole-in, .plugend-out":(e=".hole-in.hole-all, .hole-in.hole-"+t+", .plugend-out.plugend-all, .plugend-out.plugend-"+t,e+=", .hole-in.hole-bang, .plugend-out.plugend-string"),"int"!==t&&"float"!==t&&"number"!==t||(e+=", .hole-in.hole-string, .plugend-out.plugend-string",e+=", .hole-in.hole-int, .hole-in.hole-float, .hole-out.hole-number, .plugend-out.plugend-int, .plugend-out.plugend-float, .plugend-out.plugend-number"),this.$el.droppable({hoverClass:"drophover",accept:e}),this.$(".plugend").hide(),this.$(".portshown").disableSelection()},dragstart:function(e,t){this.model.node.parentGraph.view.maskFrames(),$("div.ports-"+(this.model.isIn?"out":"in")+" span.hole").addClass("fade"),$("div.ports-"+(this.model.isIn?"out":"in")+" span.hole-"+this.model.get("type_class")).addClass("highlight");var i=new Iframework.EdgeView;Iframework.edgePreview=i,this.drag(e,t),this.$(".plugend").show(),e.stopPropagation()},drag:function(e,t){var i,n,r;Iframework.edgePreview&&(i=t.offset.left+Iframework.shownGraph.view.el.scrollLeft,r=t.offset.top+8+Iframework.shownGraph.view.el.scrollTop,n=this.portOffsetLeft(),t=this.portOffsetTop(),r={fromX:this.model.isIn?i-2:n,fromY:this.model.isIn?r:t,toX:this.model.isIn?n:i+20,toY:this.model.isIn?t:r},Iframework.edgePreview.setPositions(r),Iframework.edgePreview.redraw()),e.stopPropagation()},dragstop:function(e,t){this.model.node.parentGraph.view.unmaskFrames(),$(".hole").removeClass("fade highlight"),Iframework.edgePreview.remove(),Iframework.edgePreview=void 0,this.relatedEdges().length<1&&this.$(".plugend").hide(),e.stopPropagation()},drop:function(e,t){var i,n;this.armDelete?this.armDelete=!1:(n=$(t.draggable).data("model"),i=this.model,t=this.model.isIn?n:i,n=this.model.isIn?i:n,n=new Iframework.Edge({source:[t.node.id,t.id],target:[n.node.id,n.id],parentGraph:this.model.parentNode.parentGraph}),Iframework.edgePreview&&(n._color=Iframework.edgePreview._color),n.parentGraph.addEdge(n)&&n.connect()),e.stopPropagation()},unpluggingEdge:null,armDeleteTimeout:null,armDelete:!1,topConnectedEdge:function(){var t,i=0;return _.each(this.relatedEdges(),function(e){e.view&&e.view._z>=i&&(i=e.view._z,t=e)},this),t},unplugstart:function(e,t){this.model.node.parentGraph.view.maskFrames();var i=this.topConnectedEdge();if(!i)return!1;this.unpluggingEdge=i,this.unpluggingEdge.view.dim(),1===this.relatedEdges().length&&this.$(".plugend").hide();i=this.model.isIn?this.unpluggingEdge.Source:this.unpluggingEdge.Target;this.$(".plugend").data("model",i),$("div.ports-"+(this.model.isIn?"in":"out")+" span.hole-"+this.model.get("type_class")).addClass("highlight");i=new Iframework.EdgeView;i.setColor(this.unpluggingEdge.view._color),Iframework.edgePreview=i,this.armDelete=!0,e.stopPropagation()},unplugdrag:function(e,t){var i,n,r;Iframework.edgePreview&&this.unpluggingEdge&&(i=t.offset.left+Iframework.shownGraph.view.el.scrollLeft,n=t.offset.top+6+Iframework.shownGraph.view.el.scrollTop,t=(r=(this.model.isIn?this.unpluggingEdge.Source:this.unpluggingEdge.Target).view).portOffsetLeft(),r=r.portOffsetTop(),r={fromX:this.model.isIn?t:i-2,fromY:this.model.isIn?r:n,toX:this.model.isIn?i+20:t,toY:this.model.isIn?n:r},Iframework.edgePreview.setPositions(r),Iframework.edgePreview.redraw()),e.stopPropagation()},unplugstop:function(e,t){this.armDelete&&this.unpluggingEdge?this.model.parentGraph.removeEdge(this.unpluggingEdge):(this.$(".plugend").show(),this.unpluggingEdge.view.undim()),this.armDelete=!1,this.unpluggingEdge=null,this.dragstop(e,t)},clickhole:function(e){$("div.edge-edit").remove();this.$(".hole"),this.model.isIn,this.model.get("name");var t=this.popupTemplate(this.model.toJSON()),t=$(t);this.$el.append(t),t.children("button.close").click(function(){$("div.edge-edit").remove(),Iframework.selectedPort=null});this.model.get("type").substring(0,3);$("#select_"+this.model.id).button({icons:{primary:"ui-icon-power"}}),0<this.relatedEdges().length&&(t.append("<h2>disconnect</h2>"),_.each(this.relatedEdges(),function(e){e=this.edgeEditTemplate(e.view);t.append(e)},this)),this.model.get("options")&&0<this.model.get("options").length&&this.$("input").autocomplete({minLength:0,source:this.model.get("options")}),e.stopPropagation()},disconnect:function(e){var t=this.model.parentGraph.get("edges").getByCid($(e.target).parents(".edge-edit-item").attr("id"));t&&this.model.parentGraph.removeEdge(t),$("div.edge-edit").remove(),Iframework.selectedPort=null,e.stopPropagation()},_relatedEdges:null,relatedEdges:function(){return null===this._relatedEdges&&(this._relatedEdges=this.model.parentGraph.get("edges").filter(function(e){return e.Source===this.model||e.Target===this.model},this),1<=this._relatedEdges.length?this.$(".plugend").show():this.$(".plugend").hide()),this._relatedEdges},resetRelatedEdges:function(){this._relatedEdges=null,this.relatedEdges()},highlightEdge:function(){var e;0<this.relatedEdges().length&&((e=this.topConnectedEdge())&&e.view&&e.view.highlight())},highlight:function(){var e=this.$(".plugend");e.addClass("highlight"),setTimeout(function(){e.removeClass("highlight")},1e3)},publishPort:function(){var e=this.model.parentNode.parentGraph.addNode({src:"meemoo:subgraph/output",x:500,y:500,w:80,h:60,state:{label:this.model.id},parentGraph:this.model.parentNode.parentGraph}),e=new Iframework.Edge({source:[this.model.parentNode.id,this.model.id],target:[e.id,"data"],parentGraph:this.model.parentNode.parentGraph});this.model.parentNode.parentGraph.addEdge(e)}})}),$(function(){Iframework.Module=Backbone.Model.extend({defaults:{src:"",info:{}},initialize:function(){var e=this.get("src").split(":");this.isNative="meemoo"===e[0],this.isNative&&(this.groupAndName=e[1].split("/"))},initializeView:function(){return this.view||(this.view=new Iframework.ModuleView({model:this})),this.view},toJSON:function(){return{src:this.get("src"),info:this.get("info")}}}),Iframework.Modules=Backbone.Collection.extend({model:Iframework.Module,findOrAdd:function(t){var e=this.find(function(e){return e.get("src")===t.get("src")});return e||(e=new Iframework.Module({node:t}),this.add(e)),e}})}),$(function(){Iframework.ModuleView=Backbone.View.extend({tagName:"div",className:"library-module",template:_.template('<div class="addnode button module-icon" title="<%= info.description %>"></div><h2 class="title" title="<%= src %>"><%= info.title %></h2>'),events:{"click .addnode":"addNode","dragstart .addnode":"dragStart","dragstop .addnode":"dragStop"},initialize:function(){this.render();var t=this;return this.$(".addnode").data({module:this.model}).draggable({helper:function(){var e=$('<div class="addnode-drag-helper module-icon" />').data({"meemoo-drag-type":"library-module"});return t.model.isNative&&e.addClass("module-icon-"+t.model.groupAndName[0]+"-"+t.model.groupAndName[1]),$(".app").append(e),e}}),this.model.isNative&&this.$(".addnode").addClass("module-icon-"+this.model.groupAndName[0]+"-"+this.model.groupAndName[1]),this},render:function(){this.$el.html(this.template(this.model.toJSON()))},addNode:function(e){Iframework.$(".addbyurlinput").val(this.model.get("src")),Iframework.addByUrl(e)},dragAddNode:function(e){e.src=this.model.get("src"),Iframework.shownGraph.addNode(e)},dragStart:function(){Iframework.shownGraph.view.maskFrames()},dragStop:function(){Iframework.shownGraph.view.unmaskFrames()}})}),$(function(){Iframework.Edge=Backbone.Model.extend({defaults:{source:[0,"default"],target:[0,"default"]},initialize:function(){this.parentGraph=this.get("parentGraph")},initializeView:function(){return this.view=new Iframework.EdgeView({model:this}),this.view},Source:null,Target:null,connectTryCount:5,connected:!1,connect:function(){try{this.Source=this.parentGraph.get("nodes").get(this.get("source")[0]).Outputs.get(this.get("source")[1]),this.Target=this.parentGraph.get("nodes").get(this.get("target")[0]).Inputs.get(this.get("target")[1])}catch(e){var t;return console.warn("Edge source or target port not found, try #"+this.connectTryCount+": "+this.toString()),0<this.connectTryCount&&(this.connectTryCount--,t=this,_.delay(function(){t.connect()},1e3)),!1}return!(!this.Source||!this.Target)&&(this.Source.connect(this),this.Target.connect(this),this.Source.node.receive({connect:{source:[this.Source.node.id,this.Source.id],target:[this.Target.node.id,this.Target.id]}}),this.parentGraph.view&&this.parentGraph.view.addEdge(this),this.Target.node.view&&this.Target.node.view.Native&&this.Target.node.view.Native.connectEdge(this),this.connected=!0,this.Source.node.on("send:"+this.Source.id,this.send,this),this)},send:function(e){this.Target.node.receive(this.Target.id,e)},disconnect:function(){this.Source&&this.Target&&(this.Source.disconnect(this),this.Target.disconnect(this),this.Source.node.receive({disconnect:{source:[this.Source.node.id,this.Source.id],target:[this.Target.node.id,this.Target.id]}}),this.Target.node.view&&this.Target.node.view.Native&&this.Target.node.view.Native.disconnectEdge(this)),this.view&&this.view.remove(),this.Source.node.off("send:"+this.Source.id,this.send,this),this.connected=!1},remove:function(){this.parentGraph.removeEdge(this)},toJSON:function(){return{source:this.get("source"),target:this.get("target")}},toString:function(){return this.get("source")[0]+":"+this.get("source")[1]+"->"+this.get("target")[0]+":"+this.get("target")[1]}}),Iframework.Edges=Backbone.Collection.extend({model:Iframework.Edge})}),$(function(){Iframework.EdgeView=Backbone.View.extend({tagName:"div",className:"edge",positions:null,graphSVGElement:null,elementGroup:null,elementWire:null,elementShadow:null,isPreview:!1,initialize:function(){this.model?this.graphSVGElement=this.model.parentGraph.view.edgesSvg:this.graphSVGElement=Iframework.shownGraph.view.edgesSvg,this.positions={fromX:0,fromY:0,toX:0,toY:0},this.model||(this.isPreview=!0),this.model&&this.model._color&&(this._color=this.model._color),this.render(),this.model&&(this._z=this.model.parentGraph.edgeCount++,$(this.elementWire).data({model:this.model}).click(function(e){$(e.target).data("model").view.click(e)}),this.model.Source&&this.model.Source.parentNode.on("change:x change:y change:w change:h",this.redraw,this),this.model.Target&&this.model.Target.parentNode.on("change:x change:y",this.redraw,this))},render:function(){return this.calcPositions(),this.elementGroup=this.makeSVG("g",{transform:"translate("+this.svgX()+","+this.svgY()+")",class:"wire-group"+(this.isPreview?" preview":"")}),this.elementShadow=this.makeSVG("path",{class:"wire-shadow",d:this.svgPathShadow()}),this.elementWire=this.makeSVG("path",{class:"wire",d:this.svgPath(),stroke:this.color()}),this.elementGroup.appendChild(this.elementShadow),this.elementGroup.appendChild(this.elementWire),this.graphSVGElement.appendChild(this.elementGroup),this.model&&(this.model.Source.view.$(".plugend").show(),this.model.Target.view.$(".plugend").show(),this.model.parentGraph.view.resizeEdgeSVG()),this},redraw:function(){this.calcPositions(),$(this.elementGroup).attr("transform","translate("+this.svgX()+", "+this.svgY()+")"),$(this.elementWire).attr("d",this.svgPath()),$(this.elementShadow).attr("d",this.svgPathShadow()),(this.model?this.model.parentGraph:Iframework.shownGraph).view.resizeEdgeSVG()},remove:function(){$(this.elementGroup).remove()},setPositions:function(e){this.positions=e},calcPositions:function(){var e,t;this.model&&(e=this.model.get("source")[1],t=this.model.get("target")[1],this.positions.fromX=this.model.Source.view.portOffsetLeft("out",e),this.positions.fromY=this.model.Source.view.portOffsetTop("out",e),this.positions.toX=this.model.Target.view.portOffsetLeft("in",t),this.positions.toY=this.model.Target.view.portOffsetTop("in",t))},svgX:function(){return Math.min(this.positions.toX,this.positions.fromX)-50},svgY:function(){return Math.min(this.positions.toY,this.positions.fromY)-25},svgW:function(){return Math.abs(this.positions.toX-this.positions.fromX)+100},svgH:function(){return Math.abs(this.positions.toY-this.positions.fromY)+50},pathStraight:35,pathCurve:60,svgPath:function(){var e=this.positions.fromX-this.svgX(),t=this.positions.fromY-this.svgY(),i=this.positions.toX-this.svgX(),n=this.positions.toY-this.svgY();return"M "+e+" "+t+" L "+(e+this.pathStraight)+" "+t+" C "+(e+this.pathCurve)+" "+t+" "+(i-this.pathCurve)+" "+n+" "+(i-this.pathStraight)+" "+n+" L "+i+" "+n},svgPathShadow:function(){var e=this.positions.fromX-this.svgX(),t=this.positions.fromY-this.svgY()+1,i=this.positions.toX-this.svgX(),n=this.positions.toY-this.svgY()+1;return"M "+e+" "+t+" L "+(e+this.pathStraight)+" "+t+" C "+(e+this.pathCurve)+" "+t+" "+(i-this.pathCurve)+" "+n+" "+(i-this.pathStraight)+" "+n+" L "+i+" "+n},color:function(){return this._color||(this.model?(this._color=Iframework.getWireColor(),this._color):Iframework.wireColors[Iframework.wireColorIndex])},setColor:function(e){this._color=e,$(this.elementWire).attr("stroke",e)},label:function(){return this.model.get("source")[0]+":"+this.model.get("source")[1]+'<span class="wiresymbol" style="color:'+this._color+'">&rarr;</span>'+this.model.get("target")[0]+":"+this.model.get("target")[1]},makeSVG:function(e,t){var i,n=document.createElementNS("http://www.w3.org/2000/svg",e);for(i in t)"xlink:href"===i?n.setAttributeNS("http://www.w3.org/1999/xlink","href",t[i]):n.setAttribute(i,t[i]);return n},dim:function(){$(this.elementGroup).attr("opacity",.2)},undim:function(){$(this.elementGroup).attr("opacity",1)},click:function(e){this._z<this.model.parentGraph.edgeCount-1&&(this.graphSVGElement.appendChild(this.elementGroup),this._z=this.model.parentGraph.edgeCount++),this.highlight()},highlight:function(){var e=$(this.elementShadow);e.attr("class","wire-shadow highlight"),setTimeout(function(){e.attr("class","wire-shadow")},1e3),this.model.Source.view&&this.model.Source.view.highlight(),this.model.Target.view&&this.model.Target.view.highlight()}})}),$(function(){var e=Backbone.Router.extend({routes:{"example/:url":"loadExample",new:"newBlank","local/:url":"loadLocal","gist/https://gist.github.com/:user/:id":"loadGistUgly","gist/:id":"loadGist","*path":"default"},loadExample:function(e){Iframework.loadExample(e)},loadGistUgly:function(e){this.navigate("gist/"+e,{replace:!0}),this.loadGist(e)},loadLocal:function(e){Iframework.loadLocal(e)},loadGist:function(e){Iframework.loadFromGistId(e)},newBlank:function(){Iframework.newBlank()},default:function(){}});Iframework.router=new e,Backbone.history.start()}),$(function(){Iframework.NativeNodes.image=Iframework.NodeBoxNativeView.extend({template:_.template('<div class="info" />'),canvas:null,context:null,initializeCategory:function(){var e,t,i=this;for(t in this.model.view.$("button.remove").after($('<button title="popout" type="button" class="popout icon-popup"></button>').click(function(){i.popout()})),this.model.view.$("button.remove").before($('<button title="save image" type="button" class="save-file icon-install"></button>').click(function(){i.saveFile()})),this.canvas=document.createElement("canvas"),this.canvas.width=10,this.canvas.height=10,this.context=this.canvas.getContext("2d"),$(this.canvas).attr({class:"canvas",id:"canvas-"+this.model.id}).css({maxWidth:"100%",cursor:"pointer"}).draggable({cursor:"pointer",cursorAt:{top:-10,left:-10},helper:function(e){var t=$('<div class="drag-image"><h2>Copy this</h2></div>').data({"meemoo-drag-type":"canvas","meemoo-source-node":i});return $(document.body).append(t),_.delay(function(){i.dragCopyCanvas(t)},100),t}}),this.inputs)if("image"===this.inputs[t].type){e=t;break}e&&(this.$el.append('<div class="drop-indicator"><p class="icon-login">input '+e+"</p></div>"),this.$el.droppable({accept:".canvas, .meemoo-plugin-images-thumbnail",tolerance:"pointer",hoverClass:"drop-hover",activeClass:"drop-active",greedy:!0}),this.$el.on("drop",{self:this,inputName:e},Iframework.util.imageDrop)),this.$el.prepend(this.canvas)},dragCopyCanvas:function(e){var t;e&&((t=document.createElement("canvas")).width=this.canvas.width,t.height=this.canvas.height,t.getContext("2d").drawImage(this.canvas,0,0),e.data("meemoo-drag-canvas",t),e.append(t))},scale:function(){return this.$(".canvas").width()/this.canvas.width},outputs:{image:{type:"image"}},_smoothing:!0,inputsmoothing:function(e){this._smoothing=e,this.context.webkitImageSmoothingEnabled=e,this.context.mozImageSmoothingEnabled=e},saveFile:function(){try{this.canvas.toBlob(e=>{var t=URL.createObjectURL(e);const i=document.createElement("a");i.href=t;const n=new Date;e=`${n.getFullYear()}-${String(n.getMonth()+1).padStart(2,"0")}-${String(n.getDate()).padStart(2,"0")}-${String(n.getHours()).padStart(2,"0")}-${String(n.getMinutes()).padStart(2,"0")}-`+String(n.getSeconds()).padStart(2,"0");i.download=`meemoo-${e}.png`,i.click(),URL.revokeObjectURL(t)})}catch(e){console.log(e)}},popout:function(){if(this.w)return this.popin(),!1;this.localCanvas=this.canvas,this.localContext=this.context,this.w=window.open("","meemooRemoteWindow","menubar=no,location=no,resizable=yes,scrollbars=no,status=no");var e=this;return this.w.addEventListener("unload",function(){e.popin()}),Iframework.popoutModule&&Iframework.popoutModule!==this&&Iframework.popoutModule.popin(),(Iframework.popoutModule=this).w.document.body.innerHTML="",this.canvas=this.w.document.createElement("canvas"),this.canvas.width=this.localCanvas.width,this.canvas.height=this.localCanvas.height,this.context=this.canvas.getContext("2d"),this.context.drawImage(this.localCanvas,0,0),this.w.document.body.appendChild(this.canvas),this.w.document.body.style.backgroundColor="black",this.w.document.body.style.overflow="hidden",this.w.document.body.style.margin="0px",this.w.document.body.style.padding="0px",this.w.document.title="meemoo.org",this.canvas.style.position="absolute",this.canvas.style.top="0px",this.canvas.style.left="0px",this.canvas.style.width="100%",this.inputsmoothing(this._smoothing),!1},popin:function(){return this.w&&(this.w=null),this.canvas=this.localCanvas,this.context=this.localContext,this.inputsmoothing(this._smoothing),!1}})}),$(function(){var e=$('<div><div class="sourceedit"><textarea /></div><div class="controls"><button class="button sourcerefresh icon-cw" title="refresh the source code">refresh</button><button class="button sourcecompress icon-bag" title="refresh and compress the source code into one line">compress</button><button class="button sourceapply icon-ok" title="reloads the app">apply changes</button></div></div>'),i=e.find("textarea");Iframework.addMenu("source",e,"icon-cog"),Iframework.on("change",function(e){var t;Iframework.graph&&Iframework.$(".menu-source").is(":visible")&&(t=i.prop("scrollTop"),i.val(JSON.stringify(Iframework.graph.toJSON(),null,"  ")),i.scrollTop(t))});function t(){i.val(JSON.stringify(Iframework.graph,null,"  "))}e.find(".sourcerefresh").click(t),Iframework.on("showmenu:source",t);e.find(".sourcecompress").click(function(){i.val(JSON.stringify(Iframework.graph,null,""))});e.find(".sourceapply").click(function(){var e;try{e=JSON.parse(i.val())}catch(e){return!1}return e&&(e=Iframework.loadGraph(e),Iframework._loadedLocalApp=null,t(),e.trigger("change")),!1})}),$(function(){var h=$('<div><div class="controls"><form class="addbyurl"><input class="addbyurlinput" name="addbyurlinput" placeholder="search or url" type="text" /><button class="addbyurlsubmit icon-ok" type="submit">load</button></form></div><div class="listing"></div></div>');Iframework.addMenu("library",h,"icon-plus"),Iframework.loadLibrary=function(e){var t,i=[],n=$("<div></div>");for(t in e)if(e.hasOwnProperty(t)){var r=$('<div class="library-section"></div>');r.append($('<h3><a href="#">'+t+"</a></h3>"));for(var o=$("<div></div>"),s=e[t],a=0;a<s.length;a++){var l=new Iframework.Module(s[a]);l.initializeView(),o.append(l.view.$el);l={value:l.get("src"),label:l.get("info").title+" - "+l.get("info").description+" - "+l.get("src"),title:l.get("info").title,description:l.get("info").description+" - "+l.get("src")};i.push(l)}r.append(o),n.append(r)}h.find(".listing").append(n),n.children(".library-section").accordion({animate:!1,header:"h3",heightStyle:"content",collapsible:!0,active:!1}),h.find(".addbyurlinput").autocomplete({minLength:1,source:i,select:function(e,t){_.defer(function(){Iframework.addByUrl()})}}).data("ui-autocomplete")._renderItem=function(e,t){return $("<li>").append('<a><span style="font-size:120%;">'+t.title+"</span><br>"+t.description+"</a>").appendTo(e)}};var e=Iframework.addByUrl=function(){var e=Iframework.$(".addbyurlinput");e.blur();var t,i=e.val();return""!==i&&(t=Iframework.$(".graph"),Iframework.shownGraph.addNode({src:i,x:Math.floor(t.scrollLeft()+t.width()/2)-100,y:Math.floor(t.scrollTop()+t.height()/2)-100}),e.val("").attr("placeholder","loading..."),window.setTimeout(function(){e.attr("placeholder","search or url")},1e3)),!1};h.find(".addbyurl").submit(function(){return e(),!1})}),$(function(){var o="9877b5345adf3fc";window.URL||(window.URL=window.webkitURL||window.msURL||window.oURL||!1);var t=$('<div class="meemoo-plugin-images"><div class="listing"><h2>Local images (not saved)</h2><span style="position:absolute;width:0px;overflow:hidden;"><input type="file" class="file-input-local" accept="image/*" multiple /></span><button class="localfile icon-camera" title="Not public. From computer (or mobile camera).">Choose local image</button> from computer or mobile camera<div class="image-drop local-drop"><div class="drop-indicator"><p>drag image here to hold it</p></div></div><div class="thumbnails local-listing"></div><h2>Imgur images (public)</h2><span style="position:absolute;width:0px;overflow:hidden;"><input type="file" class="file-input-public" accept="image/*" multiple /></span><button class="publicfile icon-camera" title="Import from computer (or mobile camera).">Upload</button><div class="info"></div><div class="image-drop public-drop"><div class="drop-indicator"><p class="icon-globe-1">drag image here to save to Imgur</p></div></div><div class="thumbnails public-listing"></div></div></div>');Iframework.addMenu("images",t,"icon-picture");function s(e){i.text(e)}var i=t.find(".info");Iframework.$(".show-images").droppable({accept:".canvas, .image",tolerance:"pointer",activeClass:"drop-indicator",over:function(e,t){$(this).trigger("click")}}),t.find(".image-drop").droppable({accept:".canvas",tolerance:"pointer",hoverClass:"drop-hover",activeClass:"drop-active",greedy:!0}),t.find(".public-drop").droppable({accept:".canvas, .image"}),t.find(".local-drop").on("drop",function(e,t){t=t.helper.data("meemoo-drag-canvas");if(!t)return!1;t=r(t);l.append(t)});var r=function(i){return $('<div class="meemoo-plugin-images-thumbnail canvas">').append(i).draggable({cursor:"pointer",cursorAt:{top:-10,left:-10},helper:function(e){var t=$('<div class="drag-image"><h2>Copy this</h2></div>').data({"meemoo-drag-type":"canvas","meemoo-source-image":i});return $(document.body).append(t),_.delay(function(){a(t)},100),t}})},a=function(e){var t,i;e&&(t=e.data("meemoo-source-image"),(i=document.createElement("canvas")).width=t.naturalWidth||t.width,i.height=t.naturalHeight||t.height,i.getContext("2d").drawImage(t,0,0),e.data("meemoo-drag-canvas",i),e.append(i))},e=t.find(".file-input-local"),l=t.find(".local-listing");e.change(function(e){for(var t=e.target.files,i=0;i<t.length;i++){var n=new Image;n.src=window.URL.createObjectURL(t[i]);n=r(n);l.append(n)}}),t.find(".localfile").click(function(){e.trigger("click")});var n=t.find(".file-input-public");function h(e){if(e){e=e.split(":");return"http"===e[0]&&(e[0]="https"),e.join(":")}}function d(e){var t=e.link.split(".");t[t.length-2]+="s";t=t.join("."),e=new Iframework.plugins.images.GalleryImage({id:e.id,deletehash:e.deletehash,type:e.type,link:h(e.link),linkThumb:h(t),animated:e.animated,gifv:h(e.gifv),mp4:h(e.mp4),webm:h(e.webm)});u.add(e),e.save()}n.change(function(e){var t=e.target.files;if(!(t.length<1)){s("Uploading...");for(var i=0,n=t.length;i<n;i++){var r=t[i];$.ajax({url:"https://api.imgur.com/3/image",type:"post",headers:{Authorization:"Client-ID "+o},data:r,processData:!1,success:function(t){return function(e){e.success?(d(e.data),s("Uploaded "+t+" :)")):s("Upload "+t+"failed :(")}}(r.name),error:function(e){return function(){s("Upload "+e+"failed :(")}}(r.name)})}}}),t.find(".publicfile").click(function(){n.trigger("click")}),t.find(".public-drop").on("drop",function(e,t){var i=t.helper.data("meemoo-drag-canvas"),t=t.helper.data("meemoo-source-image");if(!i&&!t)return!1;if(i)try{n=i.toDataURL().split(",",2)[1]}catch(e){return s('Not able to get image data. Right-click "Save as..." or take a screenshot.'),!1}else if(t){if("data"!==t.src.split(":")[0])return!1;var t=t.src.split(",",2),n=(t[0].split(":")[1].split(";")[0].split("/")[1],t[1])}if(!n)return!1;s("Uploading..."),$.ajax({url:"https://api.imgur.com/3/image",type:"post",headers:{Authorization:"Client-ID "+o},data:{image:n,type:"base64",title:"made with meemoo.org",description:"browser-based media hacking https://app.meemoo.org/"},dataType:"json",success:function(e){e.success?(d(e.data),s("Upload done :)")):s("Upload failed :( save it to your computer")},error:function(){s("Upload failed :( save it to your computer")}})}),Iframework.plugins.images={},Iframework.plugins.images.GalleryImage=Backbone.Model.extend({initialize:function(){this.initializeView()},initializeView:function(){return this.view||(this.view=new Iframework.plugins.images.GalleryImageView({model:this})),this.view}}),Iframework.plugins.images.GalleryImages=Backbone.Collection.extend({model:Iframework.plugins.images.GalleryImage,localStorage:new Backbone.LocalStorage("GalleryImages")});Iframework.plugins.images.GalleryImageView=Backbone.View.extend({tagName:"div",className:"meemoo-plugin-images-thumbnail",template:_.template('<img crossorigin="anonymous" title="drag to graph or image node" /><div class="controls"><a class="link button icon-link" title="Open image in new window" target="_blank"></a><a class="link-animated button icon-right-open" title="Open gifv in new window" target="_blank" style="display:none;"></a><button class="delete icon-trash" title="Delete image"></button></div>'),events:{"click .delete":"destroyModel"},initialize:function(){this.$el.html(this.template(this.model.toJSON()));var e,i=this.model.get("link");this.$(".link").attr("href",i),this.model.get("animated")&&(e=this.model.get("gifv")||i,this.$(".link-animated").attr("href",e).css({display:"inline-block"}));var n=this.$("img")[0];return n.src=this.model.get("linkThumb"),this.$el.draggable({cursor:"pointer",cursorAt:{top:-10,left:-10},helper:function(e){var t=$('<div class="drag-image"><h2>Copy this</h2></div>').data({"meemoo-drag-type":"canvas","meemoo-source-image":n,"meemoo-image-url":i});return $(document.body).append(t),_.delay(function(){a(t)},100),t}}),t.find(".public-listing").prepend(this.el),this.model.on("destroy",this.remove,this),this},destroyModel:function(){var e,t;window.confirm("Are you sure you want to delete this image?")&&((e=this.model.get("deletehash"))?(s("Deleting..."),t=this.model,$.ajax({url:"https://api.imgur.com/3/image/"+e,type:"delete",headers:{Authorization:"Client-ID "+o},success:function(e){e.success?(t.destroy(),s("Deleted")):s("Delete failed")},error:function(){s("Delete failed")}})):this.model.destroy())},remove:function(){this.$el.remove()}});var u=new Iframework.plugins.images.GalleryImages;u.fetch({success:function(e){u.each(function(e){e.initializeView()})},error:function(e){console.warn("error loading public images")}})}),$(function(){Iframework.allLoaded(),Mousetrap.bind(["command+a","ctrl+a"],function(e){Iframework.shownGraph&&Iframework.shownGraph.view&&(e.preventDefault(),Iframework.shownGraph.view.selectAll())}),Mousetrap.bind(["command+x","ctrl+x"],function(e){Iframework.shownGraph&&Iframework.shownGraph.view&&Iframework.shownGraph.view.cut()}),Mousetrap.bind(["command+c","ctrl+c"],function(e){Iframework.shownGraph&&Iframework.shownGraph.view&&Iframework.shownGraph.view.copy()}),Mousetrap.bind(["command+v","ctrl+v"],function(e){Iframework.shownGraph&&Iframework.shownGraph.view&&Iframework.shownGraph.view.paste()})});